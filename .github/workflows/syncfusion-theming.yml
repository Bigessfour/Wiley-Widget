name: Syncfusion Theming Compliance

on:
  pull_request:
    branches: [main, develop]
    paths:
      - src/WileyWidget.WinForms/**/*.cs
      - scripts/check-syncfusion-theming.py
      - .github/workflows/syncfusion-theming.yml
  push:
    branches: [main, develop]
    paths:
      - src/WileyWidget.WinForms/**/*.cs
      - scripts/check-syncfusion-theming.py
      - .github/workflows/syncfusion-theming.yml

permissions:
  contents: read
  checks: write
  pull-requests: write

concurrency:
  group: theme-check-${{ github.ref }}
  cancel-in-progress: true

jobs:
  check-theming:
    name: Syncfusion Theme Compliance Check
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: 3.11

      - name: Run Syncfusion theming compliance check
        id: theming
        shell: bash
        run: |
          if [ -f scripts/check-syncfusion-theming.py ]; then
            chmod +x scripts/check-syncfusion-theming.py
            python scripts/check-syncfusion-theming.py
            RESULT=$?
            if [ $RESULT -eq 0 ]; then
              echo "compliance_status=passed" >> $GITHUB_OUTPUT
            else
              echo "compliance_status=failed" >> $GITHUB_OUTPUT
            fi
            exit $RESULT
          else
            echo "⚠️  Theme check script not found, skipping"
            echo "compliance_status=skipped" >> $GITHUB_OUTPUT
          fi

      - name: Report compliance status
        shell: bash
        run: |
          if [ "${{ steps.theming.outputs.compliance_status }}" == "passed" ]; then
            echo "✅ Syncfusion theme compliance: PASSED"
          elif [ "${{ steps.theming.outputs.compliance_status }}" == "failed" ]; then
            echo "❌ Syncfusion theme compliance: FAILED"
            exit 1
          else
            echo "⚠️  Syncfusion theme compliance: SKIPPED"
          fi
