version: "3.8"

services:
  wiley-widget-dev:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.csx-tests
    container_name: wiley-widget-csx-dev
    volumes:
      # Bind mounts for live development
      - ./scripts:/workspaces/Wiley_Widget/scripts:ro
      - ./src:/workspaces/Wiley_Widget/src:ro
      - ./logs:/workspaces/Wiley_Widget/logs:rw
      - ./test-logs:/workspaces/Wiley_Widget/test-logs:rw
      # Named volume for NuGet cache persistence
      - wiley-widget-nuget-cache:/tmp/csharp-mcp-packages
    environment:
      - WW_REPO_ROOT=/workspaces/Wiley_Widget
      - WW_LOGS_DIR=/workspaces/Wiley_Widget/logs
      - CSX_ALLOWED_PATH=/workspaces/Wiley_Widget
      - DOTNET_CLI_TELEMETRY_OPTOUT=1
      - DOTNET_NOLOGO=1
    working_dir: /workspaces/Wiley_Widget
    command: tail -f /dev/null # Keep container running
    networks:
      - wiley-widget-net

  # Optional: Add a dedicated test runner service
  csx-test-runner:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.csx-tests
    container_name: wiley-widget-test-runner
    volumes:
      - ./scripts/examples/csharp:/app/tests:ro
      - ./logs:/app/logs:rw
      - ./test-logs:/app/test-logs:rw
      - wiley-widget-nuget-cache:/tmp/csharp-mcp-packages
    environment:
      - WW_REPO_ROOT=/app
      - WW_LOGS_DIR=/app/logs
      - CSX_ALLOWED_PATH=/app
    working_dir: /app/tests
    networks:
      - wiley-widget-net
    profiles:
      - testing

volumes:
  wiley-widget-nuget-cache:
    driver: local

networks:
  wiley-widget-net:
    driver: bridge
