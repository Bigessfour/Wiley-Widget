# AI-Fetchable Manifest

This document describes the developer-focused manifest (`ai-fetchable-manifest.json`) generated by `scripts/tools/generate_repo_urls.py`. It complements the PowerShell-based `fetchability-resources.json` by adding GitHub URLs, categories, and a lightweight search index for AI tools.

## Fetchability Assessment & EF Core Analysis

**Fetchability Rating: 9/10** - The AI-fetchable manifest significantly improves analysis capabilities compared to raw GitHub repo scans. Key benefits:

- **Precise Targeting**: Commit-specific URLs with metadata (size, line_count, sha256) enable focused analysis without full downloads
- **Efficiency**: Categorization reduces noiseâ€”focusing on "source_code" files like `AppDbContext.cs` and "automation" scripts
- **Resilience**: "valid_until" timestamp (2025-11-16) and "is_dirty: false" ensure staleness detection

**Recent EF Core Issue Resolution**: During analysis of ArgumentException in `DatabaseInitializer.cs` line 56 (MigrateAsync), the manifest enabled quick identification of the root cause in `DatabaseConfiguration.cs` through categorized file listings and dependency tracking.

### EF Core Configuration Fix Applied

**Issue**: ArgumentException ("At least one object must implement IComparable") occurred due to incorrect configuration order in `src/WileyWidget/Configuration/DatabaseConfiguration.cs`:

```csharp
// BEFORE (problematic):
ConfigureSqlServer(options, connectionString, logger, environmentName);      // Line 118
ConfigureEnterpriseDbContextOptions(options, logger);                       // Line 119
```

**Root Cause**: `ConfigureWarnings` was called AFTER `UseSqlServer`, causing EF Core 9.0 options builder state conflicts.

**Solution Applied**: Reordered configuration calls to configure general EF options before provider-specific options:

```csharp
// AFTER (fixed):
ConfigureEnterpriseDbContextOptions(options, logger);                       // Configure warnings FIRST
ConfigureSqlServer(options, connectionString, logger, environmentName);     // Then configure provider
```

This fix aligns with MVVM separation of concerns and resolves the ArgumentException during app startup.

## What it contains

- repository: remote URL, owner/repo, branch, commit hash, dirty state, generated_at
- summary: total_files, total_size, counts by categories and languages
- search_index: compact keyword list derived from file paths and descriptions
- files[]: for each file
  - metadata: path, size, last_modified, extension, language, line_count, encoding, is_binary, sha256
  - urls: blob_url, raw_url, history_url (GitHub)
  - context: category, importance, description, dependencies, related_files

## New fields and heuristics

- search_index: Up to ~500 keywords (e.g., prism, syncfusion, wpf, xaml, ai, dotnet) to improve discoverability.
- context.related_files:
  - XAML views are linked to their code-behind (\*.xaml.cs) and conventional ViewModels (e.g., BudgetView.xaml -> BudgetViewModel.cs).
  - Behavior classes link back to views that declare the `WileyWidget.Behaviors` namespace.
- context.dependencies: Tags inferred from file contents such as Prism, Syncfusion.WPF, WPF, Behaviors.

These are best-effort heuristics and do not modify source code.

## Generate the manifest

```powershell
# Generate in the repository root (all categories)
python .\scripts\tools\generate_repo_urls.py

# Include only specific categories (comma-separated)
python .\scripts\tools\generate_repo_urls.py -c source_code,documentation

# Write to a custom path
python .\scripts\tools\generate_repo_urls.py -o .\out\ai-fetchable-manifest.json
```

## Categories

- source*code (default for src/* and WileyWidget.\_ files)
- test
- documentation (docs/\*, README.md, etc.)
- automation (scripts/\*)
- configuration (_.csproj, _.sln, _.json, _.config)
- unknown

## Notes

- The manifest is read-only metadata and safe to publish.
- SHA256 hashes can be used for integrity checks.
- URLs follow the current branch as detected at generation time.
- If you filter by categories, files outside the set are omitted to reduce payload size.
