<syncfusion:RibbonWindow x:Class="WileyWidget.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:WileyWidget"
    xmlns:helpers="clr-namespace:WileyWidget.Helpers"
    xmlns:converters="clr-namespace:WileyWidget.Converters"
    xmlns:viewmodels="clr-namespace:WileyWidget.ViewModels"
    xmlns:views="clr-namespace:WileyWidget.Views"
    xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
    xmlns:syncfusionskin="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
    xmlns:notification="clr-namespace:Syncfusion.Windows.Controls.Notification;assembly=Syncfusion.SfBusyIndicator.WPF"
    xmlns:prism="http://prismlibrary.com/"
    mc:Ignorable="d"
    DataContext="{Binding MainViewModel}"
    prism:ViewModelLocator.AutoWireViewModel="True"
    syncfusionskin:SfSkinManager.VisualStyle="{Binding CurrentTheme, FallbackValue=FluentDark}"
    TextOptions.TextFormattingMode="Ideal"
    TextOptions.TextRenderingMode="ClearType"
    Title="Wiley Widget" Height="600" Width="1000" WindowState="Maximized"
    WindowStartupLocation="CenterScreen" MinWidth="1200" AllowsTransparency="False">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <local:ProfitLossTextConverter x:Key="ProfitLossTextConverter" />
        <local:ProfitBrushConverter x:Key="ProfitBrushConverter" />
        <local:ProfitBorderBrushConverter x:Key="ProfitBorderBrushConverter" />
        <local:ProfitTextBrushConverter x:Key="ProfitTextBrushConverter" />
        <local:BoolToBackgroundConverter x:Key="BoolToBackgroundConverter" />
        <local:BoolToForegroundConverter x:Key="BoolToForegroundConverter" />
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <local:EmptyStringToVisibilityConverter x:Key="EmptyStringToVisibilityConverter" />
        <local:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <SolidColorBrush x:Key="MutedTextBrush" Color="#FF666666" />
        <SolidColorBrush x:Key="CaptionTextBrush" Color="#FF999999" />
        <local:UserMessageBackgroundConverter x:Key="UserMessageBackgroundConverter" />
        <local:MessageAlignmentConverter x:Key="MessageAlignmentConverter" />
        <local:MessageForegroundConverter x:Key="MessageForegroundConverter" />
        <local:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <local:BooleanToFontWeightConverter x:Key="BooleanToFontWeightConverter" />
        <converters:BudgetOverrunStyleSelector x:Key="BudgetOverrunStyleSelector" />

        <!-- Icon Templates for Ribbon -->
        <DataTemplate x:Key="NewIcon">
            <Path Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z" Fill="White" Width="16" Height="16" />
        </DataTemplate>
        <DataTemplate x:Key="OpenIcon">
            <Path Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" Fill="White" Width="16" Height="16" />
        </DataTemplate>
        <DataTemplate x:Key="SaveIcon">
            <Path Data="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" Fill="White" Width="16" Height="16" />
        </DataTemplate>
        <DataTemplate x:Key="PrintIcon">
            <Path Data="M18,3H6V7H18M19,12A1,1 0 0,1 18,11A1,1 0 0,1 19,10A1,1 0 0,1 20,11A1,1 0 0,1 19,12M16,19H8V15H16M19,8H5A3,3 0 0,0 2,11V17H6V21H18V17H22V11A3,3 0 0,0 19,8Z" Fill="White" Width="16" Height="16" />
        </DataTemplate>
        <DataTemplate x:Key="SettingsIcon">
            <Path Data="M12,8A4,4 0 1,0 16,12A4,4 0 0,0 12,8M21.94,11H19.78A7.07,7.07 0 0,0 18.86,8.81L20.36,7.31L18.69,5.64L17.19,7.14A7.07,7.07 0 0,0 15,6.22V4.06H13V6.22A7.07,7.07 0 0,0 10.81,7.14L9.31,5.64L7.64,7.31L9.14,8.81A7.07,7.07 0 0,0 8.22,11H6.06V13H8.22A7.07,7.07 0 0,0 9.14,15.19L7.64,16.69L9.31,18.36L10.81,16.86A7.07,7.07 0 0,0 13,17.78V19.94H15V17.78A7.07,7.07 0 0,0 17.19,16.86L18.69,18.36L20.36,16.69L18.86,15.19A7.07,7.07 0 0,0 19.78,13H21.94Z" Fill="White" Width="16" Height="16" />
        </DataTemplate>
        <DataTemplate x:Key="ExitIcon">
            <Path Data="M14.08,15.59L16.67,13H9V11H16.67L14.08,8.41L15.5,7L20.5,12L15.5,17L14.08,15.59M5,5H11V7H7V17H11V19H5C3.89,19 3,18.1 3,17V7C3,5.9 3.89,5 5,5Z" Fill="White" Width="16" Height="16" />
        </DataTemplate>

        <!-- QuickBooks Tab Templates -->
        <DataTemplate x:Key="QuickBooksTabHeaderTemplate">
            <TextBlock Text="{Binding Header}" />
        </DataTemplate>

        <DataTemplate x:Key="QuickBooksTabContentTemplate">
            <syncfusion:SfDataGrid ItemsSource="{Binding Content}" AutoGenerateColumns="True" />
        </DataTemplate>

        <!-- Style for simulating separators in Syncfusion CustomMenuItem collections -->
        <Style x:Key="DockWindowMenuItemSeparatorStyle" TargetType="MenuItem">
            <Style.Triggers>
                <Trigger Property="helpers:SeparatorExt.IsSeparator" Value="True">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate>
                                <Border Height="1" Margin="5,0,5,0" BorderBrush="#FFD7D7D7" BorderThickness="0.5"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- DataTemplates for ViewModel to View mapping -->
        <DataTemplate DataType="{x:Type viewmodels:BudgetViewModel}">
            <views:BudgetPanelView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewmodels:AIAssistViewModel}">
            <views:AIAssistPanelView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewmodels:SettingsViewModel}">
            <views:SettingsPanelView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewmodels:EnterpriseViewModel}">
            <views:EnterprisePanelView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewmodels:DashboardViewModel}">
            <views:DashboardPanelView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewmodels:ToolsViewModel}">
            <views:ToolsPanelView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewmodels:MunicipalAccountViewModel}">
            <views:MunicipalAccountPanelView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewmodels:UtilityCustomerViewModel}">
            <views:UtilityCustomerPanelView />
        </DataTemplate>
    </Window.Resources>

    <!-- Keyboard Shortcuts -->
    <Window.InputBindings>
        <KeyBinding Key="C" Modifiers="Control" Command="{Binding SelectNextCommand}" />
        <KeyBinding Key="N" Modifiers="Control" Command="{Binding AddWidgetCommand}" />
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}" />
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding OpenSettingsCommand}" />
        <KeyBinding Key="F1" Command="{Binding OpenHelpCommand}" />
        <KeyBinding Key="E" Modifiers="Control" Command="{Binding OpenEnterpriseCommand}" />
        <KeyBinding Key="B" Modifiers="Control" Command="{Binding OpenBudgetCommand}" />
        <KeyBinding Key="D" Modifiers="Control" Command="{Binding OpenDashboardCommand}" />
        <KeyBinding Key="A" Modifiers="Control" Command="{Binding OpenAIAssistCommand}" />
        <KeyBinding Key="D" Modifiers="Control+Shift" Command="{Binding ToggleDynamicColumnsCommand}" />
        <KeyBinding Key="T" Modifiers="Control" Command="{Binding OpenToolsCommand}" />
    </Window.InputBindings>
    <DockPanel>
        <StatusBar DockPanel.Dock="Bottom" x:Name="MainStatusBar" Height="32">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal" Margin="4,0">
                    <TextBlock Text="View:" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding CurrentViewName}" Margin="6,0,0,0"/>
                </StackPanel>
            </StatusBarItem>
            <Separator />
            <StatusBarItem>
                <TextBlock x:Name="StatusTextBlock"
                           Text="{Binding QuickBooksStatusMessage, FallbackValue=Ready}"
                           TextTrimming="CharacterEllipsis"
                           Margin="4,0"/>
            </StatusBarItem>
            <Separator />
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal" Margin="4,0">
                    <TextBlock Text="User:" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding CurrentUserName}" Margin="6,0,0,0"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>

        <!-- Header Section with Search -->
        <Border DockPanel.Dock="Top" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                BorderThickness="0,0,0,1" Padding="20,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Search TextBox -->
                <TextBox Grid.Column="0" 
                        Text="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        Margin="0,0,20,0"
                        VerticalAlignment="Center"
                        TabIndex="1"
                        ToolTip="Search across all municipal data including enterprises, budgets, and accounts"
                        AutomationProperties.Name="Global Search"
                        AutomationProperties.HelpText="Enter text to search enterprises, budgets, and accounts">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Setter Property="Validation.ErrorTemplate">
                                <Setter.Value>
                                    <ControlTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <AdornedElementPlaceholder x:Name="textBox"/>
                                            <TextBlock Foreground="Red" FontSize="12" 
                                                     Text="{Binding ElementName=textBox, Path=AdornedElement.(Validation.Errors)[0].ErrorContent}"
                                                     VerticalAlignment="Center" Margin="5,0,0,0"/>
                                        </StackPanel>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TextBox">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="1" CornerRadius="4">
                                            <Grid>
                                                <ScrollViewer x:Name="PART_ContentHost" Margin="10,0,30,0" VerticalAlignment="Center" />
                                                <TextBlock Text="🔍 Search enterprises, budgets, accounts..."
                                                         Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                                                         Margin="10,0,0,0" VerticalAlignment="Center"
                                                         Visibility="{TemplateBinding Text, Converter={StaticResource EmptyStringToVisibilityConverter}}" />
                                            </Grid>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <!-- Quick Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <syncfusion:ButtonAdv Label="Municipal Budgets" 
                                        Command="{Binding OpenBudgetCommand}"
                                        SizeMode="Normal" 
                                        Margin="0,0,10,0"
                                        ToolTip="Click to view municipal budgets (GASB-compliant hierarchy support)" />
                    <syncfusion:ButtonAdv Label="Enterprise Dashboard" 
                                        Command="{Binding OpenDashboardCommand}"
                                        SizeMode="Normal" 
                                        Margin="0,0,10,0"
                                        ToolTip="View enterprise performance dashboard with key metrics" />
                    <syncfusion:ButtonAdv Label="QuickBooks Sync" 
                                        Command="{Binding LoadQuickBooksCustomersAsyncCommand}"
                                        SizeMode="Normal"
                                        ToolTip="Synchronize data with QuickBooks for real-time financial updates" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Ribbon rebuilt to match Syncfusion documented structure -->
        <syncfusion:Ribbon DockPanel.Dock="Top" x:Name="MainRibbon"
                           syncfusionskin:SfSkinManager.VisualStyle="FluentDark">
            <syncfusion:RibbonTab Caption="Home">
                <syncfusion:RibbonBar Header="View">
                    <syncfusion:RibbonButton Label="Refresh"
                                              Command="{Binding RefreshCommand}"
                                              SizeForm="Large" />
                    <syncfusion:RibbonButton Label="Dynamic Columns"
                                              Command="{Binding ToggleDynamicColumnsCommand}"
                                              SizeForm="Large" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="Navigation">
                    <syncfusion:RibbonButton Label="Dashboard"
                                              Command="{Binding OpenDashboardCommand}"
                                              SizeForm="Large"
                                              ToolTip="Access the main dashboard with enterprise performance metrics and KPIs" />
                    <syncfusion:RibbonButton Label="Enterprise"
                                              Command="{Binding OpenEnterpriseCommand}"
                                              SizeForm="Large"
                                              ToolTip="Manage municipal enterprises including water, sewer, and utility operations" />
                    <syncfusion:RibbonButton Label="Municipal Accounts"
                                              Command="{Binding OpenMunicipalAccountsCommand}"
                                              SizeForm="Large"
                                              ToolTip="View and manage the municipal chart of accounts with GASB compliance" />
                    <syncfusion:RibbonButton Label="Utility Customers"
                                              Command="{Binding OpenCustomerManagementCommand}"
                                              SizeForm="Large"
                                              ToolTip="Manage utility customer accounts, billing, and service requests" />
                    <syncfusion:RibbonButton Label="Budget"
                                              Command="{Binding OpenBudgetCommand}"
                                              SizeForm="Large"
                                              ToolTip="Click to view municipal budgets (GASB-compliant hierarchy support)" />
                    <syncfusion:RibbonButton Label="AI Assistant"
                                              Command="{Binding OpenAIAssistCommand}"
                                              SizeForm="Large"
                                              ToolTip="Access AI-powered assistance for municipal management and analysis" />
                    <syncfusion:RibbonButton Label="Settings"
                                              Command="{Binding OpenSettingsCommand}"
                                              SizeForm="Large"
                                              ToolTip="Configure application settings and user preferences" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="Appearance">
                    <syncfusion:RibbonButton x:Name="BtnFluentDark"
                                              Label="Fluent Dark"
                                              SizeForm="Small"
                                              Command="{Binding SwitchToFluentDarkCommand}" />
                    <syncfusion:RibbonButton x:Name="BtnFluentLight"
                                              Label="Fluent Light"
                                              SizeForm="Small"
                                              Command="{Binding SwitchToFluentLightCommand}" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="Help">
                    <syncfusion:RibbonButton Label="AI Assistant"
                                              Command="{Binding ShowAIHelpCommand}"
                                              SizeForm="Large" />
                    <syncfusion:RibbonButton Label="Help"
                                              Command="{Binding OpenHelpCommand}"
                                              SizeForm="Large" />
                </syncfusion:RibbonBar>
            </syncfusion:RibbonTab>
            <syncfusion:RibbonTab Caption="QuickBooks">
                <syncfusion:RibbonBar Header="Data Sync">
                    <syncfusion:RibbonButton Label="Load Customers"
                                              Command="{Binding LoadQuickBooksCustomersAsyncCommand}"
                                              SizeForm="Large" />
                    <syncfusion:RibbonButton Label="Load Invoices"
                                              Command="{Binding LoadQuickBooksInvoicesAsyncCommand}"
                                              SizeForm="Large" />
                    <syncfusion:RibbonButton Label="Clear Error"
                                              Command="{Binding ClearQuickBooksErrorCommand}"
                                              SizeForm="Small"
                                              IsEnabled="{Binding QuickBooksHasError}" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="Utilities">
                    <syncfusion:RibbonButton Label="Refresh All"
                                              Command="{Binding RefreshCommand}"
                                              SizeForm="Large" />
                </syncfusion:RibbonBar>
            </syncfusion:RibbonTab>
            <!-- Quick Access Toolbar (QAT) - Following Syncfusion documentation -->
            <syncfusion:Ribbon.QuickAccessToolBar>
                <!-- Quick Access Toolbar (QAT): Provides frequently used commands for rapid access.
                     This section follows Syncfusion documentation and includes Save, Refresh, Settings,
                     and additional dropdown menu items for common operations. -->
                <syncfusion:QuickAccessToolBar>
                    <!-- Frequently used commands in QAT -->
                    <syncfusion:RibbonButton SizeForm="ExtraSmall" Label="Save" Command="{Binding SaveCommand}" IconTemplate="{StaticResource SaveIcon}" AutomationProperties.Name="Save Budget Data" AutomationProperties.HelpText="Saves the current budget and financial data" />
                    <syncfusion:RibbonButton SizeForm="ExtraSmall" Label="Refresh" Command="{Binding RefreshCommand}" AutomationProperties.Name="Refresh Data" AutomationProperties.HelpText="Refreshes all displayed data from the database" />
                    <syncfusion:RibbonButton SizeForm="ExtraSmall" Label="Settings" Command="{Binding OpenSettingsCommand}" IconTemplate="{StaticResource SaveIcon}" AutomationProperties.Name="Open Settings" AutomationProperties.HelpText="Opens the application settings dialog" />
                    <!-- QAT Menu Items - Additional commands in dropdown -->
                    <syncfusion:QuickAccessToolBar.QATMenuItems>
                        <syncfusion:RibbonButton Label="New Widget" Command="{Binding AddWidgetCommand}" AutomationProperties.Name="Create New Widget" AutomationProperties.HelpText="Creates a new budget widget" />
                        <syncfusion:RibbonButton Label="Export Data" Command="{Binding ExportDataCommand}" AutomationProperties.Name="Export Financial Data" AutomationProperties.HelpText="Exports budget data to a file" />
                        <syncfusion:RibbonButton Label="Import Data" Command="{Binding ImportDataCommand}" AutomationProperties.Name="Import Financial Data" AutomationProperties.HelpText="Imports budget data from a file" />
                        <syncfusion:RibbonButton Label="Help" Command="{Binding OpenHelpCommand}" AutomationProperties.Name="Open Help" AutomationProperties.HelpText="Opens the application help documentation" />
                    </syncfusion:QuickAccessToolBar.QATMenuItems>
                </syncfusion:QuickAccessToolBar>
            </syncfusion:Ribbon.QuickAccessToolBar>
            <!-- BackStage - Application menu following Syncfusion documentation -->
            <syncfusion:Ribbon.BackStage>
                <syncfusion:Backstage>
                    <!-- BackStage tabs for application operations -->
                    <!-- KeyTip: I = Info, N = New, O = Open, S = Save, P = Print, X = Exit -->
                    <syncfusion:BackstageTabItem Header="Info" syncfusion:Ribbon.KeyTip="I">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="Wiley Widget" FontSize="24" FontWeight="Bold" Margin="0,0,0,10" />
                            <TextBlock Grid.Row="1" Text="Municipal Enterprise Management System" Margin="0,0,0,20" />
                            <TextBlock Grid.Row="2" Text="Version 1.0.0" />
                        </Grid>
                    </syncfusion:BackstageTabItem>
                    <syncfusion:BackstageTabItem Header="New" syncfusion:Ribbon.KeyTip="N">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="Create New Items" FontSize="18" FontWeight="Bold" Margin="0,0,0,15" />
                            <StackPanel Grid.Row="1" Orientation="Vertical">
                                <syncfusion:RibbonButton Label="New Enterprise" Command="{Binding AddWidgetCommand}" SizeForm="Large" Margin="0,0,0,10" />
                                <syncfusion:RibbonButton Label="New Budget" Command="{Binding OpenBudgetCommand}" SizeForm="Large" Margin="0,0,0,10" />
                                <syncfusion:RibbonButton Label="Import Data" Command="{Binding ImportDataCommand}" SizeForm="Large" />
                            </StackPanel>
                        </Grid>
                    </syncfusion:BackstageTabItem>
                    <syncfusion:BackstageTabItem Header="Open" syncfusion:Ribbon.KeyTip="O">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="Open Recent Files" FontSize="18" FontWeight="Bold" Margin="0,0,0,15" />
                            <ListBox Grid.Row="1" ItemsSource="{Binding RecentFiles}" DisplayMemberPath="Name" />
                        </Grid>
                    </syncfusion:BackstageTabItem>
                    <syncfusion:BackstageTabItem Header="Save" syncfusion:Ribbon.KeyTip="S">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="Save Options" FontSize="18" FontWeight="Bold" Margin="0,0,0,15" />
                            <StackPanel Grid.Row="1" Orientation="Vertical">
                                <syncfusion:RibbonButton Label="Save" Command="{Binding SaveCommand}" SizeForm="Large" Margin="0,0,0,10" />
                                <syncfusion:RibbonButton Label="Save As..." Command="{Binding SaveAsCommand}" SizeForm="Large" Margin="0,0,0,10" />
                                <syncfusion:RibbonButton Label="Export Data" Command="{Binding ExportDataCommand}" SizeForm="Large" />
                            </StackPanel>
                        </Grid>
                    </syncfusion:BackstageTabItem>
                    <syncfusion:BackstageTabItem Header="Print" syncfusion:Ribbon.KeyTip="P">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="Print Options" FontSize="18" FontWeight="Bold" Margin="0,0,0,15" />
                            <StackPanel Grid.Row="1" Orientation="Vertical">
                                <syncfusion:RibbonButton Label="Print" Command="{Binding PrintCommand}" SizeForm="Large" Margin="0,0,0,10" />
                                <syncfusion:RibbonButton Label="Print Preview" Command="{Binding PrintPreviewCommand}" SizeForm="Large" />
                            </StackPanel>
                        </Grid>
                    </syncfusion:BackstageTabItem>
                    <!-- Application commands at bottom of BackStage -->
                    <syncfusion:BackStageSeparator Position="Bottom" Margin="0,16,0,0" />
                    <StackPanel Margin="24,16,24,24">
                        <TextBlock Text="Application Commands"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <WrapPanel Margin="0,12,0,0">
                            <syncfusion:BackStageCommandButton
                                Header="Options"
                                Position="Bottom"
                                syncfusion:Ribbon.KeyTip="O"
                                IconTemplate="{StaticResource SettingsIcon}"
                                Command="{Binding OpenSettingsCommand}"
                                Width="180"
                                ToolTipService.ToolTip="Open Wiley Widget configuration and preferences." />
                            <syncfusion:BackStageCommandButton
                                Header="Exit"
                                Position="Bottom"
                                syncfusion:Ribbon.KeyTip="X"
                                IconTemplate="{StaticResource ExitIcon}"
                                Command="{Binding ExitCommand}"
                                Width="180"
                                Margin="12,0,0,0"
                                ToolTipService.ToolTip="Close Wiley Widget and sign off." />
                        </WrapPanel>
                    </StackPanel>
                </syncfusion:Backstage>
            </syncfusion:Ribbon.BackStage>
            <!-- Application Menu - Alternative to BackStage following Syncfusion documentation -->
            <syncfusion:Ribbon.ApplicationMenu>
                <syncfusion:ApplicationMenu Name="MainApplicationMenu" Width="38" Height="38" IsPopupOpen="False">
                    <!-- Application menu items -->
                    <syncfusion:ApplicationMenu.MenuItems>
                        <syncfusion:SimpleMenuButton Label="New Enterprise" IconTemplate="{StaticResource NewIcon}" Command="{Binding AddWidgetCommand}" />
                        <syncfusion:SimpleMenuButton Label="Open..." IconTemplate="{StaticResource OpenIcon}" Command="{Binding OpenFileCommand}" />
                        <syncfusion:SimpleMenuButton Label="Save" IconTemplate="{StaticResource SaveIcon}" Command="{Binding SaveCommand}" />
                        <Separator />
                        <syncfusion:SimpleMenuButton Label="Print..." IconTemplate="{StaticResource PrintIcon}" Command="{Binding PrintCommand}" />
                        <Separator />
                        <syncfusion:SimpleMenuButton Label="Exit" Command="{Binding ExitCommand}" />
                    </syncfusion:ApplicationMenu.MenuItems>
                    <!-- Application items at bottom -->
                    <syncfusion:ApplicationMenu.ApplicationItems>
                        <syncfusion:RibbonButton Label="Options" Command="{Binding OpenSettingsCommand}" SizeForm="Small" />
                    </syncfusion:ApplicationMenu.ApplicationItems>
                </syncfusion:ApplicationMenu>
            </syncfusion:Ribbon.ApplicationMenu>
        </syncfusion:Ribbon>

        <!-- Docking Manager (Syncfusion.Tools.WPF) -->
    <syncfusion:DockingManager x:Name="MainDockingManager"
                     UseDocumentContainer="True"
                     ContainerMode="TDI"
                     PersistState="True"
                     MaximizeButtonEnabled="True"
                     MinimizeButtonEnabled="True"
                     MaximizeMode="FullScreen"
                     IsEnableHotTracking="True"
                     CollapseDefaultContextMenuItemsInDock="False"
                     UseLayoutRounding="True"
                     EnableScrollableSidePanel="True"
                     IsVS2010DraggingEnabled="True"
                     DockWindowContextMenuItemStyle="{StaticResource DockWindowMenuItemSeparatorStyle}"
                     syncfusionskin:SfSkinManager.VisualStyle="FluentDark">

            <!-- Custom Context Menu Items -->
            <syncfusion:DockingManager.DockWindowContextMenuItems>
                <syncfusion:CustomMenuItemCollection>
                    <syncfusion:CustomMenuItem Header="Reset Layout" Command="{Binding ResetLayoutCommand}" />
                    <syncfusion:CustomMenuItem helpers:SeparatorExt.IsSeparator="True" />
                    <syncfusion:CustomMenuItem Header="Save Layout" Command="{Binding SaveLayoutCommand}" />
                    <syncfusion:CustomMenuItem Header="Load Layout" Command="{Binding LoadLayoutCommand}" />
                    <syncfusion:CustomMenuItem Header="Float Window" Command="{Binding FloatWindowCommand}" />
                    <syncfusion:CustomMenuItem Header="Auto Hide" Command="{Binding AutoHideCommand}" />
                </syncfusion:CustomMenuItemCollection>
            </syncfusion:DockingManager.DockWindowContextMenuItems>
                
                <!-- Navigation Sidebar -->
                <ContentControl x:Name="NavigationSidebar"
                              syncfusion:DockingManager.Header="Navigation"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.SideInDockedMode="Left"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="250"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="600"
                              syncfusion:DockingManager.CanMaximize="False"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="Hierarchical navigation of accounts and departments">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="📂 Accounts &amp; Departments" 
                                 FontSize="14" FontWeight="SemiBold" 
                                 Margin="10,10,10,5" />

                        <syncfusion:SfTreeView Grid.Row="1" 
                                             ItemsSource="{Binding NavigationItems}"
                                             SelectedItem="{Binding SelectedNavigationItem, Mode=TwoWay}"
                                             Margin="5"
                                             TabIndex="2"
                                             AutomationProperties.Name="Navigation Tree"
                                             AutomationProperties.HelpText="Navigate through municipal accounts and departments">
                            <syncfusion:SfTreeView.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                    <StackPanel Orientation="Horizontal" Margin="2">
                                        <TextBlock Text="{Binding DisplayText}" 
                                                 FontWeight="{Binding IsSelected, Converter={StaticResource BooleanToFontWeightConverter}}"
                                                 ToolTip="{Binding Description}" />
                                    </StackPanel>
                                </HierarchicalDataTemplate>
                            </syncfusion:SfTreeView.ItemTemplate>
                        </syncfusion:SfTreeView>
                    </Grid>
                </ContentControl>

                <!-- Main Enterprises Panel -->
                <ContentControl x:Name="WidgetsPanel"
                              syncfusion:DockingManager.Header="Municipal Enterprises"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.SideInDockedMode="Left"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="900"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="600"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="False"
                              syncfusion:DockingManager.CaptionToolTip="Main enterprise management panel - displays municipal enterprises and utilities">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Summary Bar -->
                        <Border Grid.Row="0" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                                BorderThickness="0,0,0,1" Padding="20,18" CornerRadius="8">
                            <StackPanel>
                                <TextBlock Text="Enterprise Snapshot"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"
                                           Margin="0,0,0,12" />
                                <UniformGrid Columns="5" Rows="1">
                                <StackPanel>
                                    <TextBlock Text="Total Enterprises" FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                    <TextBlock Text="{Binding Enterprises.Count}" FontSize="24" FontWeight="Bold" />
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="Citizens Served" FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                    <TextBlock Text="{Binding TotalCitizens, StringFormat=N0}" FontSize="24" FontWeight="Bold" />
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="Monthly Revenue" FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                    <TextBlock Text="{Binding TotalMonthlyRevenue, StringFormat=C0}" FontSize="24" FontWeight="Bold" Foreground="#388E3C" />
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="Monthly Expenses" FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                    <TextBlock Text="{Binding TotalMonthlyExpenses, StringFormat=C0}" FontSize="24" FontWeight="Bold" Foreground="#F57C00" />
                                </StackPanel>
                                <StackPanel>
                                    <syncfusion:ButtonAdv Label="Load Data" Command="{Binding LoadEnterprisesAsyncCommand}"
                                                        SizeMode="Normal" Margin="10,0,5,0"
                                                        IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}" />
                                    <syncfusion:ButtonAdv Label="Add New" Command="{Binding AddEnterpriseAsyncCommand}"
                                                        SizeMode="Normal" IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}" />
                                </StackPanel>
                                </UniformGrid>
                            </StackPanel>
                        </Border>

                        <!-- Search and Filter Bar -->
            <Border Grid.Row="1" Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                BorderThickness="0,0,0,1" Padding="20,14" CornerRadius="6">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="150" />
                                    <ColumnDefinition Width="150" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Search Box -->
                                <TextBox Grid.Column="0" Text="{Binding EnterpriseSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                       Margin="0,0,15,0" Padding="10,8"
                                       TabIndex="4"
                                       ToolTip="Search enterprises by name, type, or notes"
                                       Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                                       BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Setter Property="Validation.ErrorTemplate">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <AdornedElementPlaceholder x:Name="textBox"/>
                                                            <TextBlock Foreground="Red" FontSize="12" 
                                                                     Text="{Binding ElementName=textBox, Path=AdornedElement.(Validation.Errors)[0].ErrorContent}"
                                                                     VerticalAlignment="Center" Margin="5,0,0,0"/>
                                                        </StackPanel>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="TextBox">
                                                        <Border Background="{TemplateBinding Background}"
                                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                                BorderThickness="1" CornerRadius="4">
                                                            <Grid>
                                                                <ScrollViewer x:Name="PART_ContentHost" Margin="10,0,30,0" VerticalAlignment="Center" />
                                                                <TextBlock Text="🔍 Search enterprises..."
                                                                         Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                                                                         Margin="10,0,0,0" VerticalAlignment="Center"
                                                                         Visibility="{TemplateBinding Text, Converter={StaticResource EmptyStringToVisibilityConverter}}" />
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <!-- Filter by Type -->
                                <ComboBox Grid.Column="1" SelectedItem="{Binding SelectedEnterpriseTypeFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        Margin="0,0,10,0" Padding="10,8"
                                        Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                                        BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}">
                                    <ComboBoxItem Content="All Types" IsSelected="True" />
                                    <ComboBoxItem Content="Water" />
                                    <ComboBoxItem Content="Sewer" />
                                    <ComboBoxItem Content="Electric" />
                                    <ComboBoxItem Content="Gas" />
                                    <ComboBoxItem Content="Waste Management" />
                                    <ComboBoxItem Content="Other" />
                                </ComboBox>

                                <!-- Sort Options -->
                                <ComboBox Grid.Column="2" SelectedItem="{Binding SelectedSortOption, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        Margin="0,0,10,0" Padding="10,8"
                                        Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                                        BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}">
                                    <ComboBoxItem Content="Name A-Z" />
                                    <ComboBoxItem Content="Name Z-A" />
                                    <ComboBoxItem Content="Revenue High-Low" />
                                    <ComboBoxItem Content="Revenue Low-High" />
                                    <ComboBoxItem Content="Citizens High-Low" />
                                    <ComboBoxItem Content="Citizens Low-High" />
                                </ComboBox>

                                <!-- Actions -->
                                <StackPanel Grid.Column="3" Orientation="Horizontal">
                                    <syncfusion:ButtonAdv Label="Export" Command="{Binding ExportEnterprisesCommand}"
                                                        SizeMode="Normal" Margin="0,0,5,0" />
                                    <syncfusion:ButtonAdv Label="Bulk Edit" Command="{Binding BulkEditEnterprisesCommand}"
                                                        SizeMode="Normal" Margin="0,0,5,0" />
                                    <syncfusion:ButtonAdv Label="Clear Filters" Command="{Binding ClearFiltersCommand}" 
                                                        SizeMode="Normal" />
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Data Grid -->
                        <syncfusion:SfDataGrid x:Name="EnterpriseGrid" Grid.Row="2"
                                             ItemsSource="{Binding Enterprises}"
                                             SelectedItem="{Binding SelectedEnterprise, Mode=TwoWay}"
                                             AutoGenerateColumns="False"
                                             AllowSorting="True"
                                             AllowFiltering="True"
                                             AllowEditing="True"
                                             FilterRowPosition="Top"
                                             ColumnSizer="AutoWithLastColumnFill"
                                             ShowGroupDropArea="True"
                                             GroupDropAreaText="Drag a column header here to group enterprises"
                                             TabIndex="3"
                                             AutomationProperties.Name="Municipal Enterprises Data Grid"
                                             AutomationProperties.HelpText="View and edit municipal enterprise data including budgets, rates, and citizen counts"
                                             AllowGrouping="True"
                                             AllowResizingColumns="True"
                                             RowHeight="35"
                                             AlternationCount="2"
                                             AllowRowHoverHighlighting="True"
                                             ShowRowHeader="True"
                                             EnableDataVirtualization="True"
                                             UsePLINQ="True"
                                             Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                                             BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                                             ShowToolTip="True">

                            <syncfusion:SfDataGrid.GroupColumnDescriptions>
                                <syncfusion:GroupColumnDescription ColumnName="Type" />
                            </syncfusion:SfDataGrid.GroupColumnDescriptions>

                            <syncfusion:SfDataGrid.GroupSummaryRows>
                                <syncfusion:GridSummaryRow ShowSummaryInRow="True" Title="Group Summary — {{ColumnName}}: {{Key}} | Enterprises: {{ItemsCount}} | Total Budget: {{BudgetSum}}">
                                    <syncfusion:GridSummaryRow.SummaryColumns>
                                        <syncfusion:GridSummaryColumn Name="BudgetSum" MappingName="TotalBudget" SummaryType="DoubleAggregate" Format="'{Sum:C0}'" />
                                    </syncfusion:GridSummaryRow.SummaryColumns>
                                </syncfusion:GridSummaryRow>
                            </syncfusion:SfDataGrid.GroupSummaryRows>

                            <syncfusion:SfDataGrid.TableSummaryRows>
                                <syncfusion:GridTableSummaryRow
                                    Position="Bottom"
                                    ShowSummaryInRow="True"
                                    Title="Portfolio Summary — Total Enterprises: {ItemCount} | Combined Budget: {BudgetSum}"
                                    TitleColumnCount="2">
                                    <syncfusion:GridTableSummaryRow.SummaryColumns>
                                        <syncfusion:GridSummaryColumn Name="ItemCount" SummaryType="CountAggregate" Format="'{CountAggregate}'" />
                                        <syncfusion:GridSummaryColumn Name="BudgetSum" MappingName="TotalBudget" SummaryType="DoubleAggregate" Format="'{Sum:C0}'" />
                                    </syncfusion:GridTableSummaryRow.SummaryColumns>
                                </syncfusion:GridTableSummaryRow>
                            </syncfusion:SfDataGrid.TableSummaryRows>

                            <syncfusion:SfDataGrid.Columns>
                                <syncfusion:GridTextColumn HeaderText="Name" MappingName="Name" Width="180" />
                                <syncfusion:GridTextColumn HeaderText="Type" MappingName="Type" Width="120" />
                                <syncfusion:GridNumericColumn HeaderText="Rate ($)" MappingName="CurrentRate" NumberDecimalDigits="2" Width="100" />
                                <syncfusion:GridNumericColumn HeaderText="Citizens" MappingName="CitizenCount" NumberDecimalDigits="0" Width="90" />
                                <syncfusion:GridNumericColumn HeaderText="Monthly Expenses" MappingName="MonthlyExpenses" NumberDecimalDigits="0" Width="130" />
                                <syncfusion:GridNumericColumn HeaderText="Annual Budget" MappingName="TotalBudget" NumberDecimalDigits="0" Width="130">
                                    <syncfusion:GridNumericColumn.CellStyle>
                                        <Style TargetType="syncfusion:GridCell">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding TotalBudget}" Value="0">
                                                    <Setter Property="Background" Value="LightGray" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </syncfusion:GridNumericColumn.CellStyle>
                                </syncfusion:GridNumericColumn>
                                <syncfusion:GridTextColumn HeaderText="Notes" MappingName="Notes" Width="200" />
                            </syncfusion:SfDataGrid.Columns>
                        </syncfusion:SfDataGrid>

                        <!-- Loading Overlay -->
                        <Border Grid.Row="0" Grid.RowSpan="3"
                                Background="#80000000"
                                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"
                                Panel.ZIndex="100">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <notification:SfBusyIndicator Width="72"
                                                             Height="72"
                                                             AnimationType="DoubleCircle"
                                                             Foreground="White"
                                                             IsBusy="{Binding IsLoading}" />
                                <TextBlock Text="Loading enterprises..."
                                         Foreground="White"
                                         FontSize="14"
                                         Margin="0,15,0,0"
                                         HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </ContentControl>

                <!-- QuickBooks Panel -->
                <ContentControl x:Name="QuickBooksPanel" 
                              syncfusion:DockingManager.Header="QuickBooks"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.TargetNameInDockedMode="WidgetsPanel"
                              syncfusion:DockingManager.SideInDockedMode="Right"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="600"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="400"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="QuickBooks integration - sync customers and invoices">
                    <Grid>
                        <!-- Main Content -->
                        <DockPanel>
                            <Border DockPanel.Dock="Top" Margin="4" Padding="8,6" Background="#1A3F51B5" CornerRadius="6" BorderBrush="#4F92E0" BorderThickness="1">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="QuickBooks Sync"
                                               FontSize="13"
                                               FontWeight="SemiBold"
                                               Foreground="#FFFFFF"
                                               Margin="0,0,12,0" VerticalAlignment="Center" />
                                    <syncfusion:ButtonAdv Label="Load Customers" Command="{Binding LoadQuickBooksCustomersAsyncCommand}" SizeMode="Normal" Margin="0,0,6,0" ToolTip="Pull the latest customers from QuickBooks."/>
                                    <syncfusion:ButtonAdv Label="Load Invoices" Command="{Binding LoadQuickBooksInvoicesAsyncCommand}" SizeMode="Normal" Margin="0,0,6,0" ToolTip="Refresh invoice data from QuickBooks."/>
                                    <syncfusion:ButtonAdv Label="Clear Error" Command="{Binding ClearQuickBooksErrorCommand}" SizeMode="Normal" Margin="0,0,6,0" IsEnabled="{Binding QuickBooksHasError}" ToolTip="Dismiss the current QuickBooks error message."/>
                                </StackPanel>
                            </Border>

                            <!-- Status and Error Display -->
                            <Border DockPanel.Dock="Top" Margin="4" Padding="8" Background="{DynamicResource {x:Static SystemColors.InfoBrushKey}}" Visibility="{Binding QuickBooksBusy, Converter={StaticResource BoolToVis}}" CornerRadius="6" BorderBrush="#4F92E0" BorderThickness="1">
                                <TextBlock Text="{Binding QuickBooksStatusMessage}" Foreground="Blue" FontWeight="Bold"/>
                            </Border>

                            <Border DockPanel.Dock="Top" Margin="4" Padding="8" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" BorderBrush="Red" BorderThickness="1" Visibility="{Binding QuickBooksHasError, Converter={StaticResource BoolToVis}}" CornerRadius="6">
                                <StackPanel>
                                    <TextBlock Text="QuickBooks Error:" Foreground="Red" FontWeight="Bold"/>
                                    <TextBlock Text="{Binding QuickBooksErrorMessage}" TextWrapping="Wrap" Margin="0,4,0,0"/>
                                </StackPanel>
                            </Border>

                            <syncfusion:TabControlExt ItemsSource="{Binding QuickBooksTabs}"
                                                     ItemTemplate="{StaticResource QuickBooksTabHeaderTemplate}"
                                                     ContentTemplate="{StaticResource QuickBooksTabContentTemplate}"
                                                     SelectedItem="{Binding SelectedQuickBooksTab, Mode=TwoWay}" />
                        </DockPanel>

                        <!-- QuickBooks Loading Overlay -->
                        <Border Background="#80000000"
                                Visibility="{Binding QuickBooksBusy, Converter={StaticResource BoolToVis}}"
                                VerticalAlignment="Stretch"
                                HorizontalAlignment="Stretch">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <ProgressBar IsIndeterminate="True"
                                           Width="200" Height="20"
                                           Foreground="White"
                                           Background="Transparent" />
                                <TextBlock Text="Loading QuickBooks data..."
                                         Foreground="White"
                                         FontSize="14"
                                         Margin="0,10,0,0"
                                         HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </ContentControl>

                <!-- Dashboard Panel -->
                <ContentControl x:Name="DashboardPanel"
                              Content="{Binding DashboardViewModel}"
                              syncfusion:DockingManager.Header="Dashboard"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.TargetNameInDockedMode="QuickBooksPanel"
                              syncfusion:DockingManager.SideInDockedMode="Bottom"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="500"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="400"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="Dashboard overview - visualize key metrics and enterprise performance">
                </ContentControl>

                <!-- Tools & Utilities Panel -->
                <ContentControl x:Name="ToolsPanel"
                              Content="{Binding ToolsViewModel}"
                              syncfusion:DockingManager.Header="Tools &amp; Utilities"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.TargetNameInDockedMode="QuickBooksPanel"
                              syncfusion:DockingManager.SideInDockedMode="Right"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="400"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="600"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="Tools and utilities - administrative and system tools">
                </ContentControl>

                <!-- Document Panel - Demonstrates Document state -->
                <ContentControl x:Name="DocumentPanel"
                              syncfusion:DockingManager.Header="Reports &amp; Documents"
                              syncfusion:DockingManager.State="Document"
                              syncfusion:DockingManager.TargetNameInDockedMode="WidgetsPanel"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="800"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="500"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="Document tab - appears in document container with other documents">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="📄 Reports &amp; Documents" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" />
                        <ListBox Grid.Row="1" ItemsSource="{Binding DocumentList}" DisplayMemberPath="Title" />
                    </Grid>
                </ContentControl>

                <!-- Enterprise Panel -->
                <ContentControl x:Name="EnterprisePanel"
                              Content="{Binding EnterpriseViewModel}"
                              syncfusion:DockingManager.Header="Enterprise"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.TargetNameInDockedMode="WidgetsPanel"
                              syncfusion:DockingManager.SideInDockedMode="Bottom"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="600"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="400"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="Enterprise management - configure and manage municipal enterprises">
                </ContentControl>

                <!-- Budget Panel -->
                <ContentControl x:Name="BudgetPanel" 
                              Content="{Binding BudgetViewModel}"
                              syncfusion:DockingManager.Header="Budget"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.TargetNameInDockedMode="EnterprisePanel"
                              syncfusion:DockingManager.SideInDockedMode="Right"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="700"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="450"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="Budget management - plan and track financial budgets" />

                <!-- Municipal Accounts Panel -->
                <ContentControl x:Name="MunicipalAccountsPanel"
                              Content="{Binding MunicipalAccountViewModel}"
                              syncfusion:DockingManager.Header="Municipal Accounts"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.TargetNameInDockedMode="BudgetPanel"
                              syncfusion:DockingManager.SideInDockedMode="Bottom"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="700"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="400"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="Municipal chart of accounts and QuickBooks synchronization" />

                <!-- Utility Customers Panel -->
                <ContentControl x:Name="UtilityCustomersPanel"
                              Content="{Binding UtilityCustomerViewModel}"
                              syncfusion:DockingManager.Header="Utility Customers"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.TargetNameInDockedMode="MunicipalAccountsPanel"
                              syncfusion:DockingManager.SideInDockedMode="Right"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="600"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="450"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="Utility customer management - accounts, status, and contact tracking" />

                <!-- AI Assistant Panel -->
                <ContentControl x:Name="AIAssistPanel" 
                              Content="{Binding AIAssistViewModel}"
                              syncfusion:DockingManager.Header="AI Assistant"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.TargetNameInDockedMode="DashboardPanel"
                              syncfusion:DockingManager.SideInDockedMode="Bottom"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="500"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="400"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="AI Assistant - get help with calculations and municipal management" />

                <!-- Settings Panel -->
                <ContentControl x:Name="SettingsPanel" 
                              Content="{Binding SettingsViewModel}"
                              syncfusion:DockingManager.Header="Settings"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.TargetNameInDockedMode="WidgetsPanel"
                              syncfusion:DockingManager.SideInDockedMode="Left"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="350"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="500"
                              syncfusion:DockingManager.CanMaximize="True"
                              syncfusion:DockingManager.CanMinimize="True"
                              syncfusion:DockingManager.CaptionToolTip="Application settings - configure preferences and system options" />
        </syncfusion:DockingManager>
    </DockPanel>
    </syncfusion:RibbonWindow>
