<UserControl x:Class="WileyWidget.Views.Dialogs.MunicipalAccountEditDialogView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:converters="clr-namespace:WileyWidget.Converters"
             xmlns:behaviors="clr-namespace:WileyWidget.UI.Behaviors"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:syncfusionskin="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
             xmlns:models="clr-namespace:WileyWidget.Models;assembly=WileyWidget.Models"
             prism:ViewModelLocator.AutoWireViewModel="True"
             Width="600" Height="500"
             MinWidth="500" MinHeight="400"
             AutomationProperties.Name="Municipal Account Edit Dialog"
             AutomationProperties.HelpText="Dialog used for creating or editing a municipal account"
             mc:Ignorable="d"
             behaviors:FocusOnLoadBehavior.IsEnabled="True" behaviors:FocusOnLoadBehavior.TargetName="AccountNumberTextBox">
    <UserControl.Resources>
        
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis" />
        
        <ControlTemplate x:Key="ErrorTemplate">
            <DockPanel LastChildFill="True">
                <Border BorderBrush="{DynamicResource ErrorBorderBrush}" BorderThickness="1" CornerRadius="2" DockPanel.Dock="Right"
                        Background="{DynamicResource ErrorBackgroundBrush}" Margin="5,0,0,0" Width="20" Height="20">
                    <TextBlock Text="!" FontWeight="Bold" Foreground="{DynamicResource ErrorForegroundBrush}"
                              HorizontalAlignment="Center" VerticalAlignment="Center"
                              ToolTip="{Binding ElementName=adornerPlaceholder, Path=AdornedElement.(Validation.Errors)[0].ErrorContent}" />
                </Border>
                <AdornedElementPlaceholder x:Name="adornerPlaceholder" />
            </DockPanel>
        </ControlTemplate>
    </UserControl.Resources>
    <UserControl.InputBindings>
        <KeyBinding Key="Escape" Command="{Binding CancelCommand}" />
        <KeyBinding Key="Enter" Modifiers="Control" Command="{Binding SaveCommand}" />
    </UserControl.InputBindings>
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Acrylic wrapper per FluentDark guidance -->
        <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="{Binding DialogTitle}" FontSize="16" FontWeight="Bold" Margin="4"
                          AutomationProperties.Name="Municipal Account Edit Title" />

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="4" Orientation="Vertical">
                        <!-- Account Number -->
                        <Label Content="Account Number" Target="{Binding ElementName=AccountNumberTextBox}" />
                        <TextBox x:Name="AccountNumberTextBox"
                                Text="{Binding AccountNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}"
                                Validation.ErrorTemplate="{StaticResource ErrorTemplate}"
                                ToolTip="{Binding (Validation.Errors)[0].ErrorContent, RelativeSource={RelativeSource Self}}"
                                AutomationProperties.HelpText="Hierarchical account number (e.g., 405, 405.1, 410.2.1)" />

                        <!-- Account Name -->
                        <Label Content="Account Name" Target="{Binding ElementName=NameTextBox}" />
                        <TextBox x:Name="NameTextBox"
                                Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}"
                                Validation.ErrorTemplate="{StaticResource ErrorTemplate}"
                                ToolTip="{Binding (Validation.Errors)[0].ErrorContent, RelativeSource={RelativeSource Self}}"
                                AutomationProperties.HelpText="Descriptive name for the municipal account" />

                        <!-- Account Type -->
                        <Label Content="Account Type" Target="{Binding ElementName=TypeComboBox}" />
                        <ComboBox x:Name="TypeComboBox"
                                 ItemsSource="{Binding AccountTypeValues}"
                                 SelectedItem="{Binding Type, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 AutomationProperties.HelpText="Type of municipal account following GASB standards" />

                        <!-- Fund Type -->
                        <Label Content="Fund Type" Target="{Binding ElementName=FundComboBox}" />
                        <ComboBox x:Name="FundComboBox"
                                 ItemsSource="{Binding FundTypeValues}"
                                 SelectedItem="{Binding Fund, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 AutomationProperties.HelpText="Municipal fund type for this account" />

                        <!-- Balance -->
                        <Label Content="Balance" Target="{Binding ElementName=BalanceTextBox}" />
                        <syncfusion:DoubleTextBox x:Name="BalanceTextBox"
                                                 Value="{Binding Balance, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}"
                                                 NumberDecimalDigits="2"
                                                 MinValue="-999999999.99"
                                                 MaxValue="999999999.99"
                                                 Validation.ErrorTemplate="{StaticResource ErrorTemplate}"
                                                 ToolTip="{Binding (Validation.Errors)[0].ErrorContent, RelativeSource={RelativeSource Self}}"
                                                 AutomationProperties.HelpText="Current account balance">
                            <syncfusion:DoubleTextBox.Background>
                                <SolidColorBrush Color="{Binding Balance, Converter={StaticResource BalanceColorConverter}}" />
                            </syncfusion:DoubleTextBox.Background>
                        </syncfusion:DoubleTextBox>

                        <!-- Department -->
                        <Label Content="Department" Target="{Binding ElementName=DepartmentComboBox}" />
                        <ComboBox x:Name="DepartmentComboBox"
                                 ItemsSource="{Binding Departments}"
                                 SelectedItem="{Binding SelectedDepartment, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 DisplayMemberPath="Name"
                                 AutomationProperties.HelpText="Department this account belongs to" />

                        <!-- Notes -->
                        <Label Content="Notes" Target="{Binding ElementName=NotesTextBox}" />
                        <TextBox x:Name="NotesTextBox"
                                Text="{Binding Notes, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                AcceptsReturn="True"
                                TextWrapping="Wrap"
                                Height="60"
                                VerticalScrollBarVisibility="Auto"
                                AutomationProperties.HelpText="Additional notes or description for this account" />
                    </StackPanel>
                </ScrollViewer>

                <!-- Error Summary -->
                <Border Grid.Row="1" Grid.RowSpan="2" Background="{DynamicResource ErrorBackgroundBrush}"
                       BorderBrush="{DynamicResource ErrorBorderBrush}" BorderThickness="1" CornerRadius="4"
                       Padding="6" Margin="4" VerticalAlignment="Bottom" HorizontalAlignment="Stretch"
                       Visibility="{Binding ValidationSummary, Converter={StaticResource StringToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âš " Foreground="{DynamicResource ErrorForegroundBrush}" FontSize="16"
                                  Margin="0,0,8,0" VerticalAlignment="Top" />
                        <TextBlock Text="{Binding ValidationSummary}" Foreground="{DynamicResource ErrorForegroundBrush}"
                                  TextWrapping="Wrap" />
                    </StackPanel>
                </Border>

                <!-- Buttons -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                    <Button Content="Cancel" Command="{Binding CancelCommand}" Width="80" Margin="0,0,8,0"
                           AutomationProperties.Name="Cancel Button" />
                    <Button Content="Save" Command="{Binding SaveCommand}" Width="80"
                           AutomationProperties.Name="Save Button" />
                </StackPanel>
            </Grid>
</Grid>
</UserControl>
