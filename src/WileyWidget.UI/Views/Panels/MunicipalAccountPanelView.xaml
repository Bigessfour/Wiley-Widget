<UserControl x:Class="WileyWidget.Views.Panels.MunicipalAccountPanelView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:behaviors="clr-namespace:WileyWidget.UI.Behaviors"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:syncfusionskin="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
             xmlns:notification="clr-namespace:Syncfusion.Windows.Controls.Notification;assembly=Syncfusion.SfBusyIndicator.WPF"
             xmlns:converters="clr-namespace:WileyWidget.Converters"
             mc:Ignorable="d"
             d:DesignHeight="800"
             d:DesignWidth="1400" xmlns:prism="http://prismlibrary.com/" prism:ViewModelLocator.AutoWireViewModel="True">
    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis" />
        <converters:BalanceColorConverter x:Key="BalanceColorConverter" />

        <!-- Error Template for Validation -->
        <ControlTemplate x:Key="ErrorTemplate">
            <DockPanel LastChildFill="True">
                <Border BorderBrush="{DynamicResource ErrorBorderBrush}" BorderThickness="1" CornerRadius="2" DockPanel.Dock="Right"
                        Background="{DynamicResource ErrorBackgroundBrush}" Margin="5,0,0,0" Width="20" Height="20">
                    <TextBlock Text="!" FontWeight="Bold" Foreground="{DynamicResource ErrorForegroundBrush}"
                              HorizontalAlignment="Center" VerticalAlignment="Center"
                              ToolTip="{Binding ElementName=adornerPlaceholder, Path=AdornedElement.(Validation.Errors)[0].ErrorContent}" />
                </Border>
                <AdornedElementPlaceholder x:Name="adornerPlaceholder" />
            </DockPanel>
        </ControlTemplate>
    </UserControl.Resources>

    <Grid Background="#FF0F1724"
        behaviors:MouseFocusBehavior.EnableOnClick="True"
        behaviors:MouseFocusBehavior.EnableOnFirstMove="True">
        <DockPanel>
            <syncfusion:Ribbon DockPanel.Dock="Top" x:Name="AccountsRibbon">
                <syncfusion:RibbonTab Caption="Accounts">
                    <syncfusion:RibbonBar Header="Data">
                        <syncfusion:RibbonButton Label="Load Accounts"
                                                  SizeForm="Large"
                                                  Command="{Binding LoadAccountsCommand}" />
                        <syncfusion:RibbonButton Label="Sync QuickBooks"
                                                  Command="{Binding SyncFromQuickBooksCommand}" />
                        <syncfusion:RibbonButton Label="Budget Analysis"
                                                  Command="{Binding LoadBudgetAnalysisCommand}" />
                        <syncfusion:RibbonButton Label="Clear Error"
                                                  Command="{Binding ClearErrorCommand}" />
                    </syncfusion:RibbonBar>
                    <syncfusion:RibbonBar Header="Filters">
                        <StackPanel Orientation="Vertical" Margin="4,4,8,0">
                            <TextBlock Text="Fund" Margin="0,0,0,4" />
                            <ComboBox ItemsSource="{Binding FundTypeValues}"
                                                  SelectedItem="{Binding SelectedFundFilter, Mode=TwoWay}"
                                                  Width="160" />
                            <syncfusion:RibbonButton Label="Apply Fund Filter"
                                                      Margin="0,6,0,0"
                                                      Command="{Binding FilterByFundCommand}" />
                        </StackPanel>
                        <StackPanel Orientation="Vertical" Margin="8,4,4,0">
                            <TextBlock Text="Account Type" Margin="0,0,0,4" />
                            <syncfusion:ComboBoxAdv ItemsSource="{Binding AccountTypeValues}"
                                                  SelectedItem="{Binding SelectedTypeFilter, Mode=TwoWay}"
                                                  Width="160"
                                                  AutomationProperties.AutomationId="AccountTypeComboBox" />
                            <syncfusion:RibbonButton Label="Apply Type Filter"
                                                      Margin="0,6,0,0"
                                                      Command="{Binding FilterByTypeCommand}" />
                        </StackPanel>
                    </syncfusion:RibbonBar>
                </syncfusion:RibbonTab>
            </syncfusion:Ribbon>

            <Grid Margin="0,8,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Margin="12,0,12,8" Padding="12"
                        Background="#331A2C41" CornerRadius="6">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Status:" FontWeight="SemiBold" Foreground="#FFE0E6F0" />
                        <TextBlock Text="{Binding StatusMessage}" Margin="8,0,0,0" Foreground="#FFB9C8EC" />
                        <TextBlock Text="{Binding ErrorMessage}"
                                   Margin="12,0,0,0"
                                   Foreground="#FFF87171"
                                   Visibility="{Binding HasError, Converter={StaticResource BoolToVis}}" />
                    </StackPanel>
                </Border>

                <syncfusion:SfDataGrid x:Name="AccountsDataGrid" Grid.Row="1" Margin="12"
                                       ItemsSource="{Binding Accounts}"
                                       SelectedItem="{Binding SelectedAccount, Mode=TwoWay}"
                                       AutoGenerateColumns="False"
                                       AllowSorting="True"
                                       AllowFiltering="True"
                                       AllowGrouping="True"
                                       ColumnSizer="AutoWithLastColumnFill"
                                       RowHeight="30"
                                       UseLayoutRounding="True"
                                       AutomationProperties.AutomationId="PanelAccountsGrid">
                    <syncfusion:SfDataGrid.Columns>
                        <syncfusion:GridTextColumn HeaderText="Account #"
                                                  MappingName="AccountNumber.Value"
                                                  Width="140"
                                                  AllowSorting="True"
                                                  ToolTipService.ToolTip="Hierarchical account number" />
                        <syncfusion:GridTextColumn HeaderText="Name"
                                                  MappingName="Name"
                                                  Width="240"
                                                  AllowSorting="True"
                                                  ToolTipService.ToolTip="Account name/description" />
                        <syncfusion:GridTextColumn HeaderText="Fund"
                                                  MappingName="FundDescription"
                                                  Width="140"
                                                  AllowSorting="True"
                                                  AllowFiltering="True"
                                                  ToolTipService.ToolTip="Municipal fund type" />
                        <syncfusion:GridTextColumn HeaderText="Account Type"
                                                  MappingName="TypeDescription"
                                                  Width="160"
                                                  AllowSorting="True"
                                                  AllowFiltering="True"
                                                  ToolTipService.ToolTip="Account type following GASB standards" />
                        <syncfusion:GridCurrencyColumn HeaderText="Balance"
                                                      MappingName="Balance"
                                                      Width="140"
                                                      CurrencySymbol="$"
                                                      CurrencyDecimalDigits="2"
                                                      AllowSorting="True"
                                                      TextAlignment="Right"
                                                      ToolTipService.ToolTip="Current account balance">
                            <syncfusion:GridCurrencyColumn.CellStyle>
                                <Style TargetType="syncfusion:GridCell">
                                    <Setter Property="FontWeight" Value="Bold" />
                                    <Setter Property="Foreground" Value="#FF4ADE80" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Balance, Converter={StaticResource BalanceColorConverter}}" Value="Negative">
                                            <Setter Property="Foreground" Value="#FFF87171" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </syncfusion:GridCurrencyColumn.CellStyle>
                        </syncfusion:GridCurrencyColumn>
                        <syncfusion:GridTextColumn HeaderText="Notes"
                                                  MappingName="Notes"
                                                  Width="240"
                                                  AllowSorting="True"
                                                  ShowToolTip="True"
                                                  ToolTipService.ToolTip="Additional account notes" />
                    </syncfusion:SfDataGrid.Columns>
                </syncfusion:SfDataGrid>

                <Border Grid.Row="0" Grid.RowSpan="2" Background="#AA000000"
                        Visibility="{Binding IsBusy, Converter={StaticResource BoolToVis}}">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <notification:SfBusyIndicator Width="80" Height="80"
                                                     AnimationType="DoubleCircle"
                                                     IsBusy="{Binding IsBusy}" />
                        <TextBlock Text="Processing municipal accounts..."
                                   Foreground="White"
                                   FontSize="14"
                                   Margin="0,12,0,0"
                                   HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>
            </Grid>
        </DockPanel>
    </Grid>
</UserControl>
