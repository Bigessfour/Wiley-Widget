# Dockerfile.winui-tests
# Windows container image for building and testing WinUI projects.
# Note: Requires Docker Desktop running Windows containers (or a Windows Docker host).

FROM mcr.microsoft.com/dotnet/sdk:9.0-windowsservercore-ltsc2022 AS winui-build
SHELL ["powershell", "-Command", "$ErrorActionPreference = 'Stop';"]

WORKDIR C:\workspace

# Copy source (keep context small if you want faster builds)
COPY . .

# Restore and build the WinUI project
RUN Write-Host "Restoring solution..."; \
    dotnet restore WileyWidget.sln; \
    Write-Host "Building WinUI project..."; \
    dotnet build src\WileyWidget.WinUI\WileyWidget.WinUI.csproj -c Release --no-restore

# Health check: verify dotnet CLI is available
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD powershell -Command "try { dotnet --version | Out-Null; exit 0 } catch { exit 1 }"

# Run as non-root user for security
USER ContainerUser
