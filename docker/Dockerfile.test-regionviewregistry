# Dockerfile for running RegionViewRegistry tests in isolation
FROM mcr.microsoft.com/dotnet/sdk:9.0-windowsservercore-ltsc2022

# Set working directory
WORKDIR /app

# Copy test project files
COPY ["WileyWidget.Tests/WileyWidget.Tests.csproj", "WileyWidget.Tests/"]
COPY ["WileyWidget/WileyWidget.csproj", "WileyWidget/"]
COPY ["WileyWidget.Models/WileyWidget.Models.csproj", "WileyWidget.Models/"]

# Copy source code (adjust paths as needed)
COPY ["WileyWidget.Tests/", "WileyWidget.Tests/"]
COPY ["WileyWidget/", "WileyWidget/"]
COPY ["WileyWidget.Models/", "WileyWidget.Models/"]

# Copy NuGet config and restore packages
COPY ["Directory.Packages.props", "Directory.Packages.props"]
COPY ["Directory.Build.props", "Directory.Build.props"]
COPY ["Directory.Build.targets", "Directory.Build.targets"]

# Restore packages
RUN dotnet restore "WileyWidget.Tests/WileyWidget.Tests.csproj"

# Build the test project
RUN dotnet build "WileyWidget.Tests/WileyWidget.Tests.csproj" --configuration Release --no-restore

# Run only the RegionViewRegistry tests
ENTRYPOINT ["dotnet", "test", "WileyWidget.Tests/WileyWidget.Tests.csproj", \
           "--configuration", "Release", \
           "--no-build", \
           "--verbosity", "normal", \
           "--filter", "FullyQualifiedName~RegionViewRegistryTests", \
           "--logger", "console;verbosity=detailed"]