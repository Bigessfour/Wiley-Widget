<Window x:Class="WileyWidget.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WileyWidget"
        xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
        xmlns:syncfusionskin="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
        mc:Ignorable="d"
        Title="Wiley Widget" Height="600" Width="1000" WindowState="Normal" Style="{StaticResource WileyWindowStyle}">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <local:ProfitLossTextConverter x:Key="ProfitLossTextConverter" />
        <local:ProfitBrushConverter x:Key="ProfitBrushConverter" />
        <local:ProfitBorderBrushConverter x:Key="ProfitBorderBrushConverter" />
        <local:ProfitTextBrushConverter x:Key="ProfitTextBrushConverter" />
        <local:BoolToBackgroundConverter x:Key="BoolToBackgroundConverter" />
        <local:BoolToForegroundConverter x:Key="BoolToForegroundConverter" />
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <local:EmptyStringToVisibilityConverter x:Key="EmptyStringToVisibilityConverter" />
        <local:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
    </Window.Resources>

    <!-- Keyboard Shortcuts -->
    <Window.InputBindings>
        <KeyBinding Key="C" Modifiers="Control" Command="{Binding SelectNextCommand}" />
        <KeyBinding Key="N" Modifiers="Control" Command="{Binding AddWidgetCommand}" />
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}" />
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding OpenSettingsCommand}" />
        <KeyBinding Key="F1" Command="{Binding OpenHelpCommand}" />
        <KeyBinding Key="E" Modifiers="Control" Command="{Binding OpenEnterpriseCommand}" />
        <KeyBinding Key="B" Modifiers="Control" Command="{Binding OpenBudgetCommand}" />
        <KeyBinding Key="D" Modifiers="Control" Command="{Binding OpenDashboardCommand}" />
        <KeyBinding Key="A" Modifiers="Control" Command="{Binding OpenAIAssistCommand}" />
        <KeyBinding Key="D" Modifiers="Control+Shift" Command="{Binding ToggleDynamicColumnsCommand}" />
    </Window.InputBindings>
    <DockPanel>
        <!-- Basic Ribbon (Syncfusion.Tools.WPF) - documented usage pattern -->
    <syncfusion:Ribbon DockPanel.Dock="Top" x:Name="MainRibbon">
            <syncfusion:RibbonTab Caption="Home">
                <syncfusion:RibbonBar Header="Clipboard">
                    <syncfusion:RibbonButton Label="Copy" SizeForm="Large" Click="OnCopy" />
                    <syncfusion:RibbonButton Label="Paste" SizeForm="Large" Click="OnPaste"
                                           IsEnabled="{Binding IsUserAdmin}"
                                           ToolTip="Paste data from clipboard (Admin only)" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="View">
                    <syncfusion:RibbonButton Label="Refresh" />
                    <syncfusion:RibbonButton Label="Dynamic Columns" 
                                           Command="{Binding ToggleDynamicColumnsCommand}"
                                           ToolTip="Toggle dynamic column generation (Ctrl+Shift+D)" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="Theme">
                    <StackPanel Orientation="Horizontal">
                        <syncfusion:RibbonButton x:Name="BtnFluentDark" Label="Fluent Dark" Click="OnFluentDark" />
                        <syncfusion:RibbonButton x:Name="BtnFluentLight" Label="Fluent Light" Click="OnFluentLight" />
                    </StackPanel>
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="Navigation">
                    <WrapPanel Orientation="Horizontal">
                        <syncfusion:RibbonButton Label="🏠 Dashboard" SizeForm="Large"
                                               ToolTip="Open main dashboard with KPIs and analytics"
                                               Command="{Binding OpenDashboardCommand}" />
                        <syncfusion:RibbonButton Label="🏢 Enterprise" SizeForm="Large"
                                               ToolTip="Manage municipal enterprises and data"
                                               Command="{Binding OpenEnterpriseCommand}" />
                        <syncfusion:RibbonButton Label="💰 Budget" SizeForm="Large"
                                               ToolTip="Budget analysis and financial reporting"
                                               Command="{Binding OpenBudgetCommand}" />
                        <syncfusion:RibbonButton Label="🤖 AI Assistant" SizeForm="Large"
                                               ToolTip="Get AI-powered assistance and insights"
                                               Command="{Binding OpenAIAssistCommand}" />
                        <syncfusion:RibbonButton Label="⚙️ Settings" SizeForm="Large"
                                               ToolTip="Configure application settings"
                                               Command="{Binding OpenSettingsCommand}" />
                    </WrapPanel>
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="Help">
                    <syncfusion:RibbonButton Label="AI Assistant" Click="OnAIAssist" />
                    <syncfusion:RibbonButton Label="Settings" Click="OnSettings" />
                    <syncfusion:RibbonButton Label="About" Click="OnAbout" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="Authentication">
                    <StackPanel Orientation="Horizontal">
                        <!-- User info display (shown when signed in) -->
                        <StackPanel Orientation="Horizontal" 
                                  Visibility="{Binding CurrentUserName, Converter={StaticResource EmptyStringToVisibilityConverter}, ConverterParameter=invert}">
                            <Border Width="32" Height="32" Background="LightGray" CornerRadius="16" Margin="0,0,8,0">
                                <TextBlock Text="👤" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel Orientation="Vertical" VerticalAlignment="Center" Margin="0,0,16,0">
                                <TextBlock Text="{Binding CurrentUserName}" FontWeight="Bold" FontSize="12"/>
                                <TextBlock Text="{Binding CurrentUserEmail}" FontSize="10" Foreground="Gray"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Sign in/out buttons -->
                        <syncfusion:RibbonButton x:Name="BtnSignIn" Label="Sign In" SizeForm="Large"
                                               ToolTip="Sign in with Azure AD"
                                               Click="OnSignIn"
                                               Visibility="{Binding CurrentUserName, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                        <syncfusion:RibbonButton x:Name="BtnSignOut" Label="Sign Out" SizeForm="Large"
                                               ToolTip="Sign out from Azure AD"
                                               Click="OnSignOut"
                                               IsEnabled="False"
                                               Visibility="{Binding CurrentUserName, Converter={StaticResource EmptyStringToVisibilityConverter}, ConverterParameter=invert}"/>
                    </StackPanel>
                </syncfusion:RibbonBar>
            </syncfusion:RibbonTab>
        </syncfusion:Ribbon>

        <!-- Docking Manager (Syncfusion.Tools.WPF) -->
        <DockPanel LastChildFill="True">
            <syncfusion:DockingManager x:Name="MainDockingManager" 
                                     UseDocumentContainer="True" 
                                     PersistState="True"
                                     syncfusionskin:SfSkinManager.VisualStyle="FluentDark">
                
                <!-- Main Enterprises Panel -->
                <ContentControl x:Name="WidgetsPanel" 
                              syncfusion:DockingManager.Header="Municipal Enterprises"
                              syncfusion:DockingManager.State="Document">
                    <Grid>
                        <!-- Main Content -->
                        <DockPanel>
                            <!-- Summary Bar -->
                            <Border DockPanel.Dock="Top" Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="15,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Total Enterprises" FontSize="12" Foreground="#666" />
                                        <TextBlock Text="{Binding Enterprises.Count}" FontSize="18" FontWeight="Bold" />
                                    </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Citizens Served" FontSize="12" Foreground="#666" />
                                    <TextBlock Text="{Binding TotalCitizens, StringFormat=N0}" FontSize="18" FontWeight="Bold" />
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Monthly Revenue" FontSize="12" Foreground="#666" />
                                    <TextBlock Text="{Binding TotalMonthlyRevenue, StringFormat=C0}" FontSize="18" FontWeight="Bold" Foreground="#388E3C" />
                                </StackPanel>
                                <StackPanel Grid.Column="3">
                                    <TextBlock Text="Monthly Expenses" FontSize="12" Foreground="#666" />
                                    <TextBlock Text="{Binding TotalMonthlyExpenses, StringFormat=C0}" FontSize="18" FontWeight="Bold" Foreground="#F57C00" />
                                </StackPanel>
                                <StackPanel Grid.Column="4" Orientation="Horizontal">
                                    <syncfusion:ButtonAdv Label="Load Data" Command="{Binding LoadEnterprisesAsyncCommand}" Margin="0,0,5,0" />
                                    <syncfusion:ButtonAdv Label="Add New" Command="{Binding AddEnterpriseAsyncCommand}" />
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Search and Filter Bar -->
                        <Border DockPanel.Dock="Top" Background="#FAFAFA" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="15,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Search Box -->
                                <TextBox Grid.Column="0" Text="{Binding EnterpriseSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                       Margin="0,0,10,0" Padding="8,5"
                                       ToolTip="Search enterprises by name, type, or notes">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="TextBox">
                                                        <Border Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4">
                                                            <Grid>
                                                                <ScrollViewer x:Name="PART_ContentHost" Margin="8,0,24,0" VerticalAlignment="Center" />
                                                                <TextBlock Text="🔍 Search enterprises..." 
                                                                         Foreground="#999" Margin="8,0,0,0" VerticalAlignment="Center"
                                                                         Visibility="{TemplateBinding Text, Converter={StaticResource BoolToVis}, ConverterParameter=empty}" />
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <!-- Filter by Type -->
                                <ComboBox Grid.Column="1" SelectedItem="{Binding SelectedEnterpriseTypeFilter, Mode=TwoWay}" 
                                        Margin="0,0,10,0" Width="120" Padding="8,5">
                                    <ComboBoxItem Content="All Types" IsSelected="True" />
                                    <ComboBoxItem Content="Water" />
                                    <ComboBoxItem Content="Sewer" />
                                    <ComboBoxItem Content="Electric" />
                                    <ComboBoxItem Content="Gas" />
                                    <ComboBoxItem Content="Waste Management" />
                                    <ComboBoxItem Content="Other" />
                                </ComboBox>

                                <!-- Sort Options -->
                                <ComboBox Grid.Column="2" SelectedItem="{Binding SelectedSortOption, Mode=TwoWay}" 
                                        Margin="0,0,10,0" Width="120" Padding="8,5">
                                    <ComboBoxItem Content="Name A-Z" />
                                    <ComboBoxItem Content="Name Z-A" />
                                    <ComboBoxItem Content="Revenue High-Low" />
                                    <ComboBoxItem Content="Revenue Low-High" />
                                    <ComboBoxItem Content="Citizens High-Low" />
                                    <ComboBoxItem Content="Citizens Low-High" />
                                </ComboBox>

                                <!-- Export and Actions -->
                                <StackPanel Grid.Column="3" Orientation="Horizontal">
                                    <syncfusion:ButtonAdv Label="Export" Command="{Binding ExportEnterprisesCommand}" 
                                                        Margin="0,0,5,0" />
                                    <syncfusion:ButtonAdv Label="Bulk Edit" Command="{Binding BulkEditEnterprisesCommand}" 
                                                        Margin="0,0,5,0" />
                                    <syncfusion:ButtonAdv Label="Clear Filters" Command="{Binding ClearFiltersCommand}" />
                                </StackPanel>
                            </Grid>
                        </Border>

                        <syncfusion:SfDataGrid ItemsSource="{Binding Enterprises}"
                                             SelectedItem="{Binding SelectedEnterprise, Mode=TwoWay}"
                                             AutoGenerateColumns="False"
                                             x:Name="Grid"
                                             AllowSorting="True"
                                             AllowFiltering="True"
                                             AllowResizingColumns="True"
                                             GridLinesVisibility="Horizontal"
                                             RowHeight="32"
                                             AlternationCount="2">
                            <syncfusion:SfDataGrid.Columns>
                                <syncfusion:GridTextColumn HeaderText="Name" MappingName="Name" Width="150" />
                                <syncfusion:GridTextColumn HeaderText="Type" MappingName="Type" Width="100" />
                                <syncfusion:GridNumericColumn HeaderText="Rate ($)" MappingName="CurrentRate" NumberDecimalDigits="2" Width="100" />
                                <syncfusion:GridNumericColumn HeaderText="Citizens" MappingName="CitizenCount" NumberDecimalDigits="0" Width="80" />
                                <syncfusion:GridNumericColumn HeaderText="Monthly Expenses" MappingName="MonthlyExpenses" NumberDecimalDigits="0" Width="120" />
                                <syncfusion:GridNumericColumn HeaderText="Annual Budget" MappingName="TotalBudget" NumberDecimalDigits="0" Width="120" />
                                <syncfusion:GridTextColumn HeaderText="Notes" MappingName="Notes" Width="200" />
                            </syncfusion:SfDataGrid.Columns>
                        </syncfusion:SfDataGrid>
                        </DockPanel>

                        <!-- Loading Overlay -->
                        <Border Background="#80000000"
                                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"
                                VerticalAlignment="Stretch"
                                HorizontalAlignment="Stretch">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <ProgressBar IsIndeterminate="True"
                                           Width="200" Height="20"
                                           Foreground="White"
                                           Background="Transparent" />
                                <TextBlock Text="Loading enterprises..."
                                         Foreground="White"
                                         FontSize="14"
                                         Margin="0,10,0,0"
                                         HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </ContentControl>

                <!-- QuickBooks Panel -->
                <ContentControl x:Name="QuickBooksPanel" 
                              syncfusion:DockingManager.Header="QuickBooks"
                              syncfusion:DockingManager.State="Document">
                    <Grid>
                        <!-- Main Content -->
                        <DockPanel>
                            <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="4" >
                                <syncfusion:ButtonAdv Label="Load Customers" Command="{Binding LoadQuickBooksCustomersAsyncCommand}" Margin="0,0,6,0"/>
                                <syncfusion:ButtonAdv Label="Load Invoices" Command="{Binding LoadQuickBooksInvoicesAsyncCommand}" Margin="0,0,6,0"/>
                                <syncfusion:ButtonAdv Label="Clear Error" Command="{Binding ClearQuickBooksErrorCommand}" Margin="0,0,6,0" IsEnabled="{Binding QuickBooksHasError}"/>
                            </StackPanel>

                            <!-- Status and Error Display -->
                            <Border DockPanel.Dock="Top" Margin="4" Padding="8" Background="{DynamicResource {x:Static SystemColors.InfoBrushKey}}" Visibility="{Binding QuickBooksBusy, Converter={StaticResource BoolToVis}}">
                                <TextBlock Text="{Binding QuickBooksStatusMessage}" Foreground="Blue" FontWeight="Bold"/>
                            </Border>

                            <Border DockPanel.Dock="Top" Margin="4" Padding="8" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" BorderBrush="Red" BorderThickness="1" Visibility="{Binding QuickBooksHasError, Converter={StaticResource BoolToVis}}">
                                <StackPanel>
                                    <TextBlock Text="QuickBooks Error:" Foreground="Red" FontWeight="Bold"/>
                                    <TextBlock Text="{Binding QuickBooksErrorMessage}" TextWrapping="Wrap" Margin="0,4,0,0"/>
                                </StackPanel>
                            </Border>

                            <TabControl>
                                <TabItem Header="Customers">
                                    <syncfusion:SfDataGrid ItemsSource="{Binding QuickBooksCustomers}" AutoGenerateColumns="True" />
                                </TabItem>
                                <TabItem Header="Invoices">
                                    <syncfusion:SfDataGrid ItemsSource="{Binding QuickBooksInvoices}" AutoGenerateColumns="True" />
                                </TabItem>
                            </TabControl>
                        </DockPanel>

                        <!-- QuickBooks Loading Overlay -->
                        <Border Background="#80000000"
                                Visibility="{Binding QuickBooksBusy, Converter={StaticResource BoolToVis}}"
                                VerticalAlignment="Stretch"
                                HorizontalAlignment="Stretch">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <ProgressBar IsIndeterminate="True"
                                           Width="200" Height="20"
                                           Foreground="White"
                                           Background="Transparent" />
                                <TextBlock Text="Loading QuickBooks data..."
                                         Foreground="White"
                                         FontSize="14"
                                         Margin="0,10,0,0"
                                         HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </ContentControl>

                <!-- Dashboard Panel -->
                <ContentControl x:Name="DashboardPanel" 
                              syncfusion:DockingManager.Header="Dashboard"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.SideInDockedMode="Right"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="400">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="10">
                            <!-- Dashboard Header -->
                            <Border Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,0,0,2"
                                    CornerRadius="4" Margin="0,0,0,20" Padding="20">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="🏛️ Municipal Dashboard" 
                                                 FontSize="20" 
                                                 FontWeight="Bold" 
                                                 Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                        <TextBlock Text="Real-time insights into municipal enterprise performance" 
                                                 FontSize="12" 
                                                 Foreground="#666" 
                                                 Margin="0,5,0,0"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                        <syncfusion:ButtonAdv Label="🔄 Refresh" 
                                                            Command="{Binding RefreshCommand}" 
                                                            Margin="0,0,10,0" />
                                        <syncfusion:ButtonAdv Label="📊 Export" 
                                                            Command="{Binding ExportDashboardCommand}" />
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- KPI Cards -->
                            <UniformGrid Columns="2" Margin="0,0,0,25" Rows="3">
                                <!-- Total Enterprises -->
                                <Button Command="{Binding DrillDownEnterprisesCommand}" 
                                        Background="Transparent" BorderThickness="0" Padding="0"
                                        Cursor="Hand" HorizontalAlignment="Stretch">
                                    <Border Background="#E3F2FD" BorderBrush="#1976D2" BorderThickness="2"
                                            CornerRadius="8" Margin="5" Padding="15">
                                        <StackPanel>
                                            <TextBlock Text="Total Enterprises" FontSize="14" FontWeight="Bold" Foreground="#1976D2" />
                                            <TextBlock Text="{Binding TotalEnterprises}" FontSize="32" FontWeight="Bold"
                                                     Foreground="#1976D2" Margin="0,5,0,0" />
                                            <TextBlock Text="Active municipal services" FontSize="12" Foreground="#666" />
                                            <TextBlock Text="{Binding EnterprisesGrowthRate, StringFormat='↗️ +{0:F1}% this month'}" 
                                                     FontSize="11" Foreground="#1976D2" Margin="0,5,0,0" />
                                            <TextBlock Text="Click to view details" FontSize="10" Foreground="#1976D2" 
                                                     Opacity="0.7" Margin="0,5,0,0" />
                                        </StackPanel>
                                    </Border>
                                </Button>

                                <!-- Total Citizens Served -->
                                <Button Command="{Binding DrillDownCitizensCommand}" 
                                        Background="Transparent" BorderThickness="0" Padding="0"
                                        Cursor="Hand" HorizontalAlignment="Stretch">
                                    <Border Background="#F3E5F5" BorderBrush="#7B1FA2" BorderThickness="2"
                                            CornerRadius="8" Margin="5" Padding="15">
                                        <StackPanel>
                                            <TextBlock Text="Citizens Served" FontSize="14" FontWeight="Bold" Foreground="#7B1FA2" />
                                            <TextBlock Text="{Binding TotalCitizens, StringFormat=N0}" FontSize="32" FontWeight="Bold"
                                                     Foreground="#7B1FA2" Margin="0,5,0,0" />
                                            <TextBlock Text="Total population covered" FontSize="12" Foreground="#666" />
                                            <TextBlock Text="{Binding CitizensGrowthRate, StringFormat='↗️ +{0:F1}% this month'}" 
                                                     FontSize="11" Foreground="#7B1FA2" Margin="0,5,0,0" />
                                            <TextBlock Text="Click to view details" FontSize="10" Foreground="#7B1FA2" 
                                                     Opacity="0.7" Margin="0,5,0,0" />
                                        </StackPanel>
                                    </Border>
                                </Button>

                                <!-- Monthly Revenue -->
                                <Button Command="{Binding DrillDownRevenueCommand}" 
                                        Background="Transparent" BorderThickness="0" Padding="0"
                                        Cursor="Hand" HorizontalAlignment="Stretch">
                                    <Border Background="#E8F5E8" BorderBrush="#388E3C" BorderThickness="2"
                                            CornerRadius="8" Margin="5" Padding="15">
                                        <StackPanel>
                                            <TextBlock Text="Monthly Revenue" FontSize="14" FontWeight="Bold" Foreground="#388E3C" />
                                            <TextBlock Text="{Binding TotalMonthlyRevenue, StringFormat=C0}" FontSize="28" FontWeight="Bold"
                                                     Foreground="#388E3C" Margin="0,5,0,0" />
                                            <TextBlock Text="{Binding AverageRatePerCitizen, StringFormat=Avg: C2 per citizen}" FontSize="12" Foreground="#666" />
                                            <TextBlock Text="{Binding RevenueGrowthRate, StringFormat='↗️ +{0:F1}% vs last month'}" 
                                                     FontSize="11" Foreground="#388E3C" Margin="0,5,0,0" />
                                            <TextBlock Text="Click to view details" FontSize="10" Foreground="#388E3C" 
                                                     Opacity="0.7" Margin="0,5,0,0" />
                                        </StackPanel>
                                    </Border>
                                </Button>

                                <!-- Monthly Expenses -->
                                <Button Command="{Binding DrillDownExpensesCommand}" 
                                        Background="Transparent" BorderThickness="0" Padding="0"
                                        Cursor="Hand" HorizontalAlignment="Stretch">
                                    <Border Background="#FFF3E0" BorderBrush="#F57C00" BorderThickness="2"
                                            CornerRadius="8" Margin="5" Padding="15">
                                        <StackPanel>
                                            <TextBlock Text="Monthly Expenses" FontSize="14" FontWeight="Bold" Foreground="#F57C00" />
                                            <TextBlock Text="{Binding TotalMonthlyExpenses, StringFormat=C0}" FontSize="28" FontWeight="Bold"
                                                     Foreground="#F57C00" Margin="0,5,0,0" />
                                            <TextBlock Text="{Binding BudgetUtilizationPercentage, StringFormat=Budget used: {0:F1}%}" FontSize="12" Foreground="#666" />
                                            <TextBlock Text="{Binding ExpenseGrowthRate, StringFormat='↗️ +{0:F1}% vs last month'}" 
                                                     FontSize="11" Foreground="#F57C00" Margin="0,5,0,0" />
                                            <TextBlock Text="Click to view details" FontSize="10" Foreground="#F57C00" 
                                                     Opacity="0.7" Margin="0,5,0,0" />
                                        </StackPanel>
                                    </Border>
                                </Button>

                                <!-- Net Profit/Loss -->
                                <Button Command="{Binding DrillDownProfitCommand}" 
                                        Background="Transparent" BorderThickness="0" Padding="0"
                                        Cursor="Hand" HorizontalAlignment="Stretch">
                                    <Border Background="{Binding NetMonthlyProfit, Converter={StaticResource ProfitBrushConverter}}" 
                                            BorderBrush="{Binding NetMonthlyProfit, Converter={StaticResource ProfitBorderBrushConverter}}" 
                                            BorderThickness="2"
                                            CornerRadius="8" Margin="5" Padding="15">
                                        <StackPanel>
                                            <TextBlock Text="{Binding NetMonthlyProfit, Converter={StaticResource ProfitLossTextConverter}}" 
                                                     FontSize="14" FontWeight="Bold" 
                                                     Foreground="{Binding NetMonthlyProfit, Converter={StaticResource ProfitTextBrushConverter}}" />
                                            <TextBlock Text="{Binding NetMonthlyProfit, StringFormat=C0}" FontSize="28" FontWeight="Bold"
                                                     Foreground="{Binding NetMonthlyProfit, Converter={StaticResource ProfitTextBrushConverter}}" Margin="0,5,0,0" />
                                            <TextBlock Text="Monthly net position" FontSize="12" Foreground="#666" />
                                            <TextBlock Text="{Binding ProfitMarginPercentage, StringFormat='Profit margin: {0:F1}%'}" 
                                                     FontSize="11" Foreground="{Binding NetMonthlyProfit, Converter={StaticResource ProfitTextBrushConverter}}" Margin="0,5,0,0" />
                                            <TextBlock Text="Click to view details" 
                                                     FontSize="10" Foreground="{Binding NetMonthlyProfit, Converter={StaticResource ProfitTextBrushConverter}}" 
                                                     Opacity="0.7" Margin="0,5,0,0" />
                                        </StackPanel>
                                    </Border>
                                </Button>
                            </UniformGrid>

                            <!-- Charts and Analytics Section -->
                            <Border Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1"
                                    CornerRadius="8" Margin="0,0,0,15" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="📊 Analytics Overview" FontSize="16" FontWeight="Bold" Margin="0,0,0,15" />

                                    <Grid Margin="0,0,0,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Revenue Trend Chart -->
                                        <GroupBox Grid.Column="0" Header="Revenue Trend (6 Months)" Margin="0,0,10,0" Padding="10">
                                            <syncfusion:SfChart Height="120">
                                                <syncfusion:SfChart.PrimaryAxis>
                                                    <syncfusion:CategoryAxis />
                                                </syncfusion:SfChart.PrimaryAxis>
                                                <syncfusion:SfChart.SecondaryAxis>
                                                    <syncfusion:NumericalAxis LabelFormat="C0" />
                                                </syncfusion:SfChart.SecondaryAxis>
                                                <syncfusion:LineSeries ItemsSource="{Binding RevenueTrendData}"
                                                                     XBindingPath="Period"
                                                                     YBindingPath="Amount"
                                                                     Interior="#2196F3" />
                                            </syncfusion:SfChart>
                                        </GroupBox>

                                        <!-- Expense Breakdown Chart -->
                                        <GroupBox Grid.Column="1" Header="Expense Categories" Margin="10,0,0,0" Padding="10">
                                            <syncfusion:SfChart Height="120">
                                                <syncfusion:SfChart.Legend>
                                                    <syncfusion:ChartLegend />
                                                </syncfusion:SfChart.Legend>
                                                <syncfusion:PieSeries ItemsSource="{Binding ExpenseCategoryData}"
                                                                     XBindingPath="Category"
                                                                     YBindingPath="Amount"
                                                                     Label="Category"
                                                                     ExplodeAll="True"
                                                                     ExplodeRadius="5" />
                                            </syncfusion:SfChart>
                                        </GroupBox>
                                    </Grid>

                                    <!-- Enterprise Distribution Chart -->
                                    <GroupBox Header="Enterprise Distribution by Type" Padding="10" Margin="0,15,0,0">
                                        <syncfusion:SfChart Height="120">
                                            <syncfusion:SfChart.Legend>
                                                <syncfusion:ChartLegend />
                                            </syncfusion:SfChart.Legend>
                                            <syncfusion:PieSeries ItemsSource="{Binding EnterpriseTypeData}"
                                                                 XBindingPath="Type"
                                                                 YBindingPath="Count"
                                                                 Label="Type"
                                                                 ExplodeAll="True"
                                                                 ExplodeRadius="5" />
                                        </syncfusion:SfChart>
                                    </GroupBox>
                                </StackPanel>
                            </Border>

                            <!-- Alerts and Notifications -->
                            <Border Background="#FFF8E1" BorderBrush="#F57C00" BorderThickness="1"
                                    CornerRadius="8" Margin="0,0,0,15" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="🚨 Active Alerts" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" />

                                    <ItemsControl ItemsSource="{Binding ActiveAlerts}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#FFFFFF" BorderBrush="{Binding PriorityColor}" BorderThickness="1" 
                                                        CornerRadius="4" Margin="0,0,0,8" Padding="10">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="{Binding Priority}" FontSize="12" FontWeight="Bold" 
                                                                 Foreground="{Binding PriorityColor}" Margin="0,0,10,0" />
                                                        <StackPanel Grid.Column="1">
                                                            <TextBlock Text="{Binding Message}" FontSize="12" TextWrapping="Wrap" />
                                                        </StackPanel>
                                                        <TextBlock Grid.Column="2" Text="{Binding Timestamp, StringFormat=HH:mm}" 
                                                                 FontSize="10" Foreground="#999" VerticalAlignment="Top" />
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <TextBlock Text="No active alerts" FontSize="12" Foreground="#666" 
                                             Visibility="{Binding ActiveAlerts.Count, Converter={StaticResource BoolToVis}, ConverterParameter=0}" />
                                </StackPanel>
                            </Border>

                            <!-- QuickBooks Integration Status -->
                            <Border Background="#F5F5F5" BorderBrush="#BDBDBD" BorderThickness="1"
                                    CornerRadius="8" Margin="0,0,0,15" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="QuickBooks Integration" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" />
                                    
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="Customers" FontSize="12" Foreground="#666" />
                                            <TextBlock Text="{Binding TotalQuickBooksCustomers}" FontSize="20" FontWeight="Bold" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="Invoices" FontSize="12" Foreground="#666" />
                                            <TextBlock Text="{Binding TotalQuickBooksInvoices}" FontSize="20" FontWeight="Bold" />
                                        </StackPanel>
                                    </Grid>

                                    <TextBlock Text="{Binding TotalInvoiceAmount, StringFormat=Total Value: C0}" 
                                             FontSize="14" FontWeight="Bold" Foreground="#1976D2" />

                                    <!-- Status Indicator -->
                                    <Border Background="{Binding QuickBooksHasError, Converter={StaticResource BoolToBackgroundConverter}}" 
                                            CornerRadius="4" Margin="0,10,0,0" Padding="8">
                                        <TextBlock Text="{Binding QuickBooksStatusMessage, FallbackValue='Ready'}" 
                                                 FontSize="12" 
                                                 Foreground="{Binding QuickBooksHasError, Converter={StaticResource BoolToForegroundConverter}}" />
                                    </Border>
                                </StackPanel>
                            </Border>

                            <!-- Recent Activity -->
                            <Border Background="#FAFAFA" BorderBrush="#E0E0E0" BorderThickness="1"
                                    CornerRadius="8" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="System Status" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" />
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBlock Text="Data Status:" FontSize="12" Width="80" />
                                        <TextBlock Text="{Binding DataStatus, FallbackValue='Loading...'}" FontSize="12" FontWeight="Bold" />
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBlock Text="User:" FontSize="12" Width="80" />
                                        <TextBlock Text="{Binding CurrentUserName}" FontSize="12" FontWeight="Bold" />
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Last Updated:" FontSize="12" Width="80" />
                                        <TextBlock Text="{Binding DateTime.Now, StringFormat=HH:mm:ss}" FontSize="12" FontWeight="Bold" />
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </ContentControl>

                <!-- Enterprise Panel -->
                <ContentControl x:Name="EnterprisePanel" 
                              syncfusion:DockingManager.Header="Enterprise"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.SideInDockedMode="Right"
                              syncfusion:DockingManager.DesiredWidthInDockedMode="500">
                    <DockPanel>
                        <!-- Enterprise Header -->
                        <Border DockPanel.Dock="Top" Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,0,0,1" Padding="15,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding SelectedEnterprise.Name, FallbackValue='Select an Enterprise'}" 
                                             FontSize="16" FontWeight="Bold" />
                                    <TextBlock Text="{Binding SelectedEnterprise.Type, FallbackValue='No enterprise selected'}" 
                                             FontSize="12" Foreground="#666" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <syncfusion:ButtonAdv Label="Edit" Command="{Binding EditEnterpriseCommand}" 
                                                        Margin="0,0,5,0" IsEnabled="{Binding HasSelectedEnterprise}" />
                                    <syncfusion:ButtonAdv Label="Save" Command="{Binding SaveEnterpriseCommand}" 
                                                        Margin="0,0,5,0" IsEnabled="{Binding CanSaveEnterprise}" />
                                    <syncfusion:ButtonAdv Label="Delete" Command="{Binding DeleteEnterpriseCommand}" 
                                                        IsEnabled="{Binding HasSelectedEnterprise}" />
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Enterprise Details -->
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="15">
                                <!-- Enterprise Information -->
                                <Border Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1" 
                                        CornerRadius="8" Margin="0,0,0,15" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="Enterprise Details" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" />

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Name:" VerticalAlignment="Center" />
                                            <TextBox Grid.Column="1" Text="{Binding SelectedEnterprise.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                   Margin="5,0,0,0" />
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Type:" VerticalAlignment="Center" />
                                            <ComboBox Grid.Column="1" SelectedItem="{Binding SelectedEnterprise.Type, Mode=TwoWay}" 
                                                    Margin="5,0,0,0">
                                                <ComboBoxItem Content="Water" />
                                                <ComboBoxItem Content="Sewer" />
                                                <ComboBoxItem Content="Electric" />
                                                <ComboBoxItem Content="Gas" />
                                                <ComboBoxItem Content="Waste Management" />
                                                <ComboBoxItem Content="Other" />
                                            </ComboBox>
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Current Rate ($):" VerticalAlignment="Center" />
                                            <syncfusion:DoubleTextBox Grid.Column="1" Value="{Binding SelectedEnterprise.CurrentRate, Mode=TwoWay}" 
                                                                    Margin="5,0,0,0" />
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Citizens Served:" VerticalAlignment="Center" />
                                            <syncfusion:IntegerTextBox Grid.Column="1" Value="{Binding SelectedEnterprise.CitizenCount, Mode=TwoWay}" 
                                                                     Margin="5,0,0,0" />
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Monthly Expenses:" VerticalAlignment="Center" />
                                            <syncfusion:DoubleTextBox Grid.Column="1" Value="{Binding SelectedEnterprise.MonthlyExpenses, Mode=TwoWay}" 
                                                                    Margin="5,0,0,0" />
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Annual Budget:" VerticalAlignment="Center" />
                                            <syncfusion:DoubleTextBox Grid.Column="1" Value="{Binding SelectedEnterprise.TotalBudget, Mode=TwoWay}" 
                                                                    Margin="5,0,0,0" />
                                        </Grid>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Notes:" VerticalAlignment="Top" Margin="0,5,0,0" />
                                            <TextBox Grid.Column="1" Text="{Binding SelectedEnterprise.Notes, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                   Margin="5,0,0,0" Height="60" TextWrapping="Wrap" AcceptsReturn="True" 
                                                   VerticalScrollBarVisibility="Auto" />
                                        </Grid>
                                    </StackPanel>
                                </Border>

                                <!-- Financial Analysis -->
                                <Border Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1" 
                                        CornerRadius="8" Margin="0,0,0,15" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="Financial Analysis" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" />

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Background="#E8F5E8" BorderBrush="#388E3C" BorderThickness="1" 
                                                    CornerRadius="4" Margin="0,0,5,0" Padding="10">
                                                <StackPanel>
                                                    <TextBlock Text="Monthly Revenue" FontSize="12" Foreground="#666" />
                                                    <TextBlock Text="{Binding SelectedEnterprise.MonthlyRevenue, StringFormat=C0}" 
                                                             FontSize="18" FontWeight="Bold" Foreground="#388E3C" />
                                                </StackPanel>
                                            </Border>
                                            <Border Grid.Column="1" Background="#FFF3E0" BorderBrush="#F57C00" BorderThickness="1" 
                                                    CornerRadius="4" Margin="5,0,0,0" Padding="10">
                                                <StackPanel>
                                                    <TextBlock Text="Monthly Profit" FontSize="12" Foreground="#666" />
                                                    <TextBlock Text="{Binding SelectedEnterprise.MonthlyProfit, StringFormat=C0}" 
                                                             FontSize="18" FontWeight="Bold" 
                                                             Foreground="{Binding SelectedEnterprise.MonthlyProfit, Converter={StaticResource ProfitTextBrushConverter}}" />
                                                </StackPanel>
                                            </Border>
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Background="#E3F2FD" BorderBrush="#1976D2" BorderThickness="1" 
                                                    CornerRadius="4" Margin="0,0,5,0" Padding="10">
                                                <StackPanel>
                                                    <TextBlock Text="Budget Utilization" FontSize="12" Foreground="#666" />
                                                    <TextBlock Text="{Binding SelectedEnterprise.BudgetUtilization, StringFormat={}{0:F1}%}" 
                                                             FontSize="18" FontWeight="Bold" Foreground="#1976D2" />
                                                </StackPanel>
                                            </Border>
                                            <Border Grid.Column="1" Background="#F3E5F5" BorderBrush="#7B1FA2" BorderThickness="1" 
                                                    CornerRadius="4" Margin="5,0,0,0" Padding="10">
                                                <StackPanel>
                                                    <TextBlock Text="Rate per Citizen" FontSize="12" Foreground="#666" />
                                                    <TextBlock Text="{Binding SelectedEnterprise.RatePerCitizen, StringFormat=C2}" 
                                                             FontSize="18" FontWeight="Bold" Foreground="#7B1FA2" />
                                                </StackPanel>
                                            </Border>
                                        </Grid>
                                    </StackPanel>
                                </Border>

                                <!-- Performance Metrics -->
                                <Border Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1" 
                                        CornerRadius="8" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="Performance Metrics" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" />

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="Efficiency Rating" FontSize="12" Foreground="#666" />
                                                <TextBlock Text="{Binding SelectedEnterprise.EfficiencyRating, StringFormat={}{0:F1}/10}" 
                                                         FontSize="16" FontWeight="Bold" />
                                            </StackPanel>
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="Service Quality" FontSize="12" Foreground="#666" />
                                                <TextBlock Text="{Binding SelectedEnterprise.ServiceQuality, StringFormat={}{0:F1}/10}" 
                                                         FontSize="16" FontWeight="Bold" />
                                            </StackPanel>
                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="Customer Satisfaction" FontSize="12" Foreground="#666" />
                                                <TextBlock Text="{Binding SelectedEnterprise.CustomerSatisfaction, StringFormat={}{0:F1}/10}" 
                                                         FontSize="16" FontWeight="Bold" />
                                            </StackPanel>
                                        </Grid>

                                        <TextBlock Text="Recent Activity" FontSize="14" FontWeight="Bold" Margin="0,15,0,5" />
                                        <ListBox ItemsSource="{Binding SelectedEnterprise.RecentActivity}" 
                                                Height="100" BorderThickness="1" BorderBrush="#E9ECEF">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}" FontSize="11" />
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </ScrollViewer>
                    </DockPanel>
                </ContentControl>

                <!-- Budget Panel -->
                <ContentControl x:Name="BudgetPanel" 
                              syncfusion:DockingManager.Header="Budget"
                              syncfusion:DockingManager.State="Dock"
                              syncfusion:DockingManager.SideInDockedMode="Bottom"
                              syncfusion:DockingManager.DesiredHeightInDockedMode="400">
                    <DockPanel>
                        <!-- Budget Header -->
                        <Border DockPanel.Dock="Top" Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,0,0,1" Padding="15,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Budget Analysis &amp; Forecasting" FontSize="16" FontWeight="Bold" />
                                    <TextBlock Text="{Binding CurrentFiscalYear, StringFormat='Fiscal Year: {0}'}" FontSize="12" Foreground="#666" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <syncfusion:ButtonAdv Label="Generate Report" Command="{Binding GenerateBudgetReportCommand}" Margin="0,0,5,0" />
                                    <syncfusion:ButtonAdv Label="Export Data" Command="{Binding ExportBudgetDataCommand}" />
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Budget Overview -->
                        <Grid DockPanel.Dock="Top" Margin="15,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Background="#E8F5E8" BorderBrush="#388E3C" BorderThickness="1" 
                                    CornerRadius="4" Margin="0,0,5,0" Padding="10">
                                <StackPanel>
                                    <TextBlock Text="Total Budget" FontSize="12" Foreground="#666" />
                                    <TextBlock Text="{Binding TotalAnnualBudget, StringFormat=C0}" 
                                             FontSize="16" FontWeight="Bold" Foreground="#388E3C" />
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="1" Background="#FFF3E0" BorderBrush="#F57C00" BorderThickness="1" 
                                    CornerRadius="4" Margin="5,0,5,0" Padding="10">
                                <StackPanel>
                                    <TextBlock Text="Total Expenses" FontSize="12" Foreground="#666" />
                                    <TextBlock Text="{Binding TotalAnnualExpenses, StringFormat=C0}" 
                                             FontSize="16" FontWeight="Bold" Foreground="#F57C00" />
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="2" Background="#E3F2FD" BorderBrush="#1976D2" BorderThickness="1" 
                                    CornerRadius="4" Margin="5,0,5,0" Padding="10">
                                <StackPanel>
                                    <TextBlock Text="Budget Variance" FontSize="12" Foreground="#666" />
                                    <TextBlock Text="{Binding BudgetVariance, StringFormat=C0}" 
                                             FontSize="16" FontWeight="Bold" 
                                             Foreground="{Binding BudgetVariance, Converter={StaticResource ProfitTextBrushConverter}}" />
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="3" Background="#F3E5F5" BorderBrush="#7B1FA2" BorderThickness="1" 
                                    CornerRadius="4" Margin="5,0,0,0" Padding="10">
                                <StackPanel>
                                    <TextBlock Text="Budget Utilization" FontSize="12" Foreground="#666" />
                                    <TextBlock Text="{Binding OverallBudgetUtilization, StringFormat={}{0:F1}%}" 
                                             FontSize="16" FontWeight="Bold" Foreground="#7B1FA2" />
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!-- Main Content Area -->
                        <Grid Margin="15,0,15,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- Budget vs Actual Chart -->
                            <Border Grid.Column="0" Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1" 
                                    CornerRadius="8" Margin="0,0,10,0" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="Budget vs Actual by Month" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" />

                                    <!-- Placeholder for Chart - would use Syncfusion Chart control -->
                                    <Border Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="1" Height="200" 
                                            CornerRadius="4" Margin="0,0,0,10">
                                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <TextBlock Text="📊 Budget vs Actual Chart" FontSize="14" Foreground="#666" />
                                            <TextBlock Text="Chart visualization would be implemented here" FontSize="10" Foreground="#999" Margin="0,5,0,0" />
                                        </StackPanel>
                                    </Border>

                                    <!-- Monthly Breakdown -->
                                    <TextBlock Text="Monthly Breakdown" FontSize="12" FontWeight="Bold" Margin="0,0,0,5" />
                                    <ListBox ItemsSource="{Binding MonthlyBudgetData}" Height="120" BorderThickness="1" BorderBrush="#E9ECEF">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Margin="0,2">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="80" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="{Binding Month}" FontSize="11" />
                                                    <TextBlock Grid.Column="1" Text="{Binding Budget, StringFormat=C0}" FontSize="11" Foreground="#666" />
                                                    <TextBlock Grid.Column="2" Text="{Binding Actual, StringFormat=C0}" FontSize="11" />
                                                    <TextBlock Grid.Column="3" Text="{Binding Variance, StringFormat=C0}" FontSize="11" 
                                                             Foreground="{Binding Variance, Converter={StaticResource ProfitTextBrushConverter}}" />
                                                </Grid>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </StackPanel>
                            </Border>

                            <!-- Expense Categories -->
                            <Border Grid.Column="1" Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1" 
                                    CornerRadius="8" Margin="10,0,0,0" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="Expense Categories" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" />

                                    <!-- Expense Breakdown Chart Placeholder -->
                                    <Border Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="1" Height="150" 
                                            CornerRadius="4" Margin="0,0,0,10">
                                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <TextBlock Text="🥧 Expense Breakdown" FontSize="14" Foreground="#666" />
                                            <TextBlock Text="Pie chart visualization" FontSize="10" Foreground="#999" Margin="0,5,0,0" />
                                        </StackPanel>
                                    </Border>

                                    <!-- Category List -->
                                    <TextBlock Text="By Category" FontSize="12" FontWeight="Bold" Margin="0,0,0,5" />
                                    <ListBox ItemsSource="{Binding ExpenseCategories}" Height="140" BorderThickness="1" BorderBrush="#E9ECEF">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Margin="0,3">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="80" />
                                                        <ColumnDefinition Width="60" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="{Binding CategoryName}" FontSize="11" />
                                                    <TextBlock Grid.Column="1" Text="{Binding Amount, StringFormat=C0}" FontSize="11" FontWeight="Bold" />
                                                    <TextBlock Grid.Column="2" Text="{Binding Percentage, StringFormat={}{0:F1}%}" FontSize="11" Foreground="#666" />
                                                </Grid>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!-- Budget Alerts and Recommendations -->
                        <Border DockPanel.Dock="Bottom" Background="#FFF8E1" BorderBrush="#F57C00" BorderThickness="1" 
                                CornerRadius="4" Margin="15,0,15,15" Padding="10">
                            <StackPanel>
                                <TextBlock Text="⚠️ Budget Alerts &amp; Recommendations" FontSize="12" FontWeight="Bold" Margin="0,0,0,5" />
                                <ItemsControl ItemsSource="{Binding BudgetAlerts}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" FontSize="11" Margin="0,2,0,0" TextWrapping="Wrap" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </DockPanel>
                </ContentControl>

                <!-- AI Assistant Panel -->
                <ContentControl x:Name="AIAssistPanel" 
                              syncfusion:DockingManager.Header="AI Assistant"
                              syncfusion:DockingManager.State="AutoHidden"
                              syncfusion:DockingManager.SideInDockedMode="Right">
                    <DockPanel>
                        <!-- AI Assistant Header -->
                        <Border DockPanel.Dock="Top" Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,0,0,1" Padding="15,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="🤖 AI Assistant" FontSize="16" FontWeight="Bold" />
                                    <TextBlock Text="Get insights and assistance with municipal data" FontSize="12" Foreground="#666" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <syncfusion:ButtonAdv Label="Clear" Command="{Binding ClearConversationCommand}" Margin="0,0,5,0" />
                                    <syncfusion:ButtonAdv Label="Help" Command="{Binding ShowAIHelpCommand}" />
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Conversation History -->
                        <ScrollViewer x:Name="ConversationScrollViewer" VerticalScrollBarVisibility="Auto" Margin="0,0,0,80">
                            <ItemsControl ItemsSource="{Binding ChatMessages}" Margin="15,10">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding IsUserMessage, Converter={StaticResource UserMessageBackgroundConverter}}" 
                                                CornerRadius="8" Margin="0,0,0,10" Padding="12">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Avatar -->
                                                <Border Grid.Column="0" Width="32" Height="32" CornerRadius="16" 
                                                        Background="{Binding IsUserMessage, Converter={StaticResource MessageAlignmentConverter}, ConverterParameter=background}"
                                                        Margin="0,0,10,0">
                                                    <TextBlock Text="{Binding IsUserMessage, Converter={StaticResource MessageAlignmentConverter}, ConverterParameter=avatar}" 
                                                             HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                             FontSize="14" FontWeight="Bold" />
                                                </Border>

                                                <!-- Message Content -->
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Sender}" FontSize="11" FontWeight="Bold" 
                                                             Foreground="{Binding IsUserMessage, Converter={StaticResource MessageForegroundConverter}}" 
                                                             Margin="0,0,0,2" />
                                                    <TextBlock Text="{Binding Message}" FontSize="13" TextWrapping="Wrap" 
                                                             Foreground="{Binding IsUserMessage, Converter={StaticResource MessageForegroundConverter}}" />
                                                    <TextBlock Text="{Binding Timestamp, StringFormat=HH:mm:ss}" FontSize="10" 
                                                             Foreground="#999" Margin="0,2,0,0" />
                                                </StackPanel>

                                                <!-- Message Actions -->
                                                <StackPanel Grid.Column="2" VerticalAlignment="Top" Margin="10,0,0,0">
                                                    <Button Content="📋" ToolTip="Copy message" 
                                                          Command="{Binding DataContext.CopyMessageCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" 
                                                          CommandParameter="{Binding}"
                                                          Style="{StaticResource WileySecondaryButtonStyle}" 
                                                          Width="20" Height="20" FontSize="10" Margin="0,0,0,2" />
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Message Input Area -->
                        <Border DockPanel.Dock="Bottom" Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,1,0,0" Padding="15,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Message Input -->
                                <TextBox x:Name="AIMessageInput" Grid.Column="0" 
                                       Text="{Binding AIMessageInput, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                       Height="40" Margin="0,0,10,0" Padding="10,5"
                                       TextWrapping="Wrap" AcceptsReturn="True"
                                       VerticalScrollBarVisibility="Auto"
                                       BorderBrush="#E9ECEF" BorderThickness="1"
                                       Background="#FFFFFF"
                                       FontSize="13"
                                       ToolTip="Type your message to the AI assistant..."
                                       KeyDown="OnAIMessageKeyDown" />

                                <!-- Send Button -->
                                <syncfusion:ButtonAdv Grid.Column="1" Label="Send" 
                                                    Command="{Binding SendAIMessageCommand}"
                                                    IsEnabled="{Binding CanSendAIMessage}"
                                                    Height="40" Width="60"
                                                    ToolTip="Send message to AI assistant" />
                            </Grid>
                        </Border>

                        <!-- AI Status Bar -->
                        <Border DockPanel.Dock="Bottom" Background="#E8F5E8" BorderBrush="#388E3C" BorderThickness="0,1,0,0" 
                                Padding="10,5" Visibility="{Binding AIIsTyping, Converter={StaticResource BoolToVis}}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="🤖 AI is thinking..." FontSize="11" Foreground="#388E3C" />
                                <ProgressBar Width="100" Height="4" Margin="10,0,0,0" 
                                           Foreground="#388E3C" Background="#E8F5E8" 
                                           IsIndeterminate="True" />
                            </StackPanel>
                        </Border>

                        <!-- Quick Actions -->
                        <Border DockPanel.Dock="Bottom" Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,1,0,0" 
                                Padding="15,10" Visibility="{Binding ChatMessages.Count, Converter={StaticResource BoolToVis}, ConverterParameter=0}">
                            <StackPanel>
                                <TextBlock Text="💡 Quick Actions" FontSize="12" FontWeight="Bold" Margin="0,0,0,8" />
                                <WrapPanel>
                                    <syncfusion:ButtonAdv Label="📊 Analyze Budget" 
                                                        Command="{Binding QuickAIAnalysisCommand}" 
                                                        CommandParameter="budget"
                                                        Margin="0,0,5,5" />
                                    <syncfusion:ButtonAdv Label="🏢 Enterprise Insights" 
                                                        Command="{Binding QuickAIAnalysisCommand}" 
                                                        CommandParameter="enterprise"
                                                        Margin="0,0,5,5" />
                                    <syncfusion:ButtonAdv Label="📈 Performance Trends" 
                                                        Command="{Binding QuickAIAnalysisCommand}" 
                                                        CommandParameter="performance"
                                                        Margin="0,0,5,5" />
                                    <syncfusion:ButtonAdv Label="🎯 Recommendations" 
                                                        Command="{Binding QuickAIAnalysisCommand}" 
                                                        CommandParameter="recommendations"
                                                        Margin="0,0,5,5" />
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                    </DockPanel>
                </ContentControl>

                <!-- Settings Panel -->
                <ContentControl x:Name="SettingsPanel" 
                              syncfusion:DockingManager.Header="Settings"
                              syncfusion:DockingManager.State="AutoHidden"
                              syncfusion:DockingManager.SideInDockedMode="Left">
                    <DockPanel>
                        <!-- Settings Header -->
                        <Border DockPanel.Dock="Top" Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,0,0,1" Padding="15,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="⚙️ Application Settings" FontSize="16" FontWeight="Bold" />
                                    <TextBlock Text="Configure Wiley Widget preferences and integrations" FontSize="12" Foreground="#666" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <syncfusion:ButtonAdv Label="Reset" Command="{Binding ResetSettingsCommand}" Margin="0,0,5,0" />
                                    <syncfusion:ButtonAdv Label="Save" Command="{Binding SaveSettingsCommand}" />
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Settings Content -->
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="15">
                                <!-- General Settings -->
                                <Border Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1" 
                                        CornerRadius="8" Margin="0,0,0,15" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="🎨 General Settings" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" />

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="200" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Theme:" VerticalAlignment="Center" />
                                            <ComboBox Grid.Column="1" SelectedItem="{Binding SelectedTheme, Mode=TwoWay}" Margin="10,0,0,0">
                                                <ComboBoxItem Content="Fluent Dark" />
                                                <ComboBoxItem Content="Fluent Light" />
                                                <ComboBoxItem Content="Material Dark" />
                                                <ComboBoxItem Content="Material Light" />
                                            </ComboBox>
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="200" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Auto-save interval (minutes):" VerticalAlignment="Center" />
                                            <syncfusion:IntegerTextBox Grid.Column="1" Value="{Binding AutoSaveInterval, Mode=TwoWay}" 
                                                                     Margin="10,0,0,0" MinValue="1" MaxValue="60" />
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="200" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Default currency:" VerticalAlignment="Center" />
                                            <ComboBox Grid.Column="1" SelectedItem="{Binding DefaultCurrency, Mode=TwoWay}" Margin="10,0,0,0">
                                                <ComboBoxItem Content="USD ($)" />
                                                <ComboBoxItem Content="EUR (€)" />
                                                <ComboBoxItem Content="GBP (£)" />
                                                <ComboBoxItem Content="CAD (C$)" />
                                            </ComboBox>
                                        </Grid>

                                        <CheckBox Content="Enable notifications" IsChecked="{Binding EnableNotifications, Mode=TwoWay}" Margin="0,5,0,0" />
                                        <CheckBox Content="Auto-refresh data" IsChecked="{Binding AutoRefreshData, Mode=TwoWay}" Margin="0,5,0,0" />
                                        <CheckBox Content="Show welcome screen on startup" IsChecked="{Binding ShowWelcomeScreen, Mode=TwoWay}" Margin="0,5,0,0" />
                                    </StackPanel>
                                </Border>

                                <!-- Data Management -->
                                <Border Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1" 
                                        CornerRadius="8" Margin="0,0,0,15" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="💾 Data Management" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" />

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="200" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Data backup location:" VerticalAlignment="Center" />
                                            <TextBox Grid.Column="1" Text="{Binding BackupLocation, Mode=TwoWay}" Margin="10,0,0,0" />
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="200" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Backup frequency:" VerticalAlignment="Center" />
                                            <ComboBox Grid.Column="1" SelectedItem="{Binding BackupFrequency, Mode=TwoWay}" Margin="10,0,0,0">
                                                <ComboBoxItem Content="Daily" />
                                                <ComboBoxItem Content="Weekly" />
                                                <ComboBoxItem Content="Monthly" />
                                                <ComboBoxItem Content="Manual only" />
                                            </ComboBox>
                                        </Grid>

                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                            <syncfusion:ButtonAdv Label="Backup Now" Command="{Binding BackupDataCommand}" Margin="0,0,10,0" />
                                            <syncfusion:ButtonAdv Label="Restore" Command="{Binding RestoreDataCommand}" Margin="0,0,10,0" />
                                            <syncfusion:ButtonAdv Label="Clear Cache" Command="{Binding ClearCacheCommand}" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Integration Settings -->
                                <Border Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1" 
                                        CornerRadius="8" Margin="0,0,0,15" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="🔗 Integrations" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" />

                                        <!-- QuickBooks Integration -->
                                        <Border Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="1" 
                                                CornerRadius="4" Margin="0,0,0,10" Padding="10">
                                            <StackPanel>
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                    <TextBlock Text="QuickBooks Online" FontSize="13" FontWeight="Bold" />
                                                    <TextBlock Text="{Binding QuickBooksStatus}" FontSize="11" 
                                                             Foreground="{Binding QuickBooksStatus, Converter={StaticResource BoolToForegroundConverter}}" 
                                                             Margin="10,0,0,0" />
                                                </StackPanel>
                                                <TextBlock Text="Connect your QuickBooks account for automatic financial data synchronization" 
                                                         FontSize="11" Foreground="#666" Margin="0,0,0,8" />
                                                <StackPanel Orientation="Horizontal">
                                                    <syncfusion:ButtonAdv Label="Connect" Command="{Binding ConnectQuickBooksCommand}" 
                                                                        IsEnabled="{Binding QuickBooksStatus, Converter={StaticResource BoolToBackgroundConverter}}" 
                                                                        Margin="0,0,5,0" />
                                                    <syncfusion:ButtonAdv Label="Disconnect" Command="{Binding DisconnectQuickBooksCommand}" 
                                                                        Margin="0,0,5,0" />
                                                    <syncfusion:ButtonAdv Label="Test Connection" Command="{Binding TestQuickBooksCommand}" />
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>

                                        <!-- Azure Integration -->
                                        <Border Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="1" 
                                                CornerRadius="4" Margin="0,0,0,10" Padding="10">
                                            <StackPanel>
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                    <TextBlock Text="Azure AD" FontSize="13" FontWeight="Bold" />
                                                    <TextBlock Text="{Binding AzureStatus}" FontSize="11" 
                                                             Foreground="{Binding AzureStatus, Converter={StaticResource BoolToForegroundConverter}}" 
                                                             Margin="10,0,0,0" />
                                                </StackPanel>
                                                <TextBlock Text="Enable Azure Active Directory authentication and cloud services" 
                                                         FontSize="11" Foreground="#666" Margin="0,0,0,8" />
                                                <StackPanel Orientation="Horizontal">
                                                    <syncfusion:ButtonAdv Label="Configure" Command="{Binding ConfigureAzureCommand}" 
                                                                        Margin="0,0,5,0" />
                                                    <syncfusion:ButtonAdv Label="Test Connection" Command="{Binding TestAzureCommand}" />
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </Border>

                                <!-- Advanced Settings -->
                                <Border Background="#FFFFFF" BorderBrush="#E9ECEF" BorderThickness="1" 
                                        CornerRadius="8" Margin="0,0,0,15" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="🔧 Advanced Settings" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" />

                                        <CheckBox Content="Enable debug logging" IsChecked="{Binding EnableDebugLogging, Mode=TwoWay}" Margin="0,5,0,0" />
                                        <CheckBox Content="Enable performance monitoring" IsChecked="{Binding EnablePerformanceMonitoring, Mode=TwoWay}" Margin="0,5,0,0" />
                                        <CheckBox Content="Enable experimental features" IsChecked="{Binding EnableExperimentalFeatures, Mode=TwoWay}" Margin="0,5,0,0" />

                                        <TextBlock Text="Log file location:" FontSize="12" Margin="0,10,0,5" />
                                        <TextBox Text="{Binding LogFileLocation, Mode=TwoWay}" IsReadOnly="True" Background="#F8F9FA" />

                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                            <syncfusion:ButtonAdv Label="View Logs" Command="{Binding ViewLogsCommand}" Margin="0,0,10,0" />
                                            <syncfusion:ButtonAdv Label="Open Log Folder" Command="{Binding OpenLogFolderCommand}" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- About Section -->
                                <Border Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="1" 
                                        CornerRadius="8" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="ℹ️ About Wiley Widget" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" />

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Version:" FontSize="12" />
                                            <TextBlock Grid.Column="1" Text="{Binding ApplicationVersion}" FontSize="12" FontWeight="Bold" />
                                        </Grid>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="License:" FontSize="12" />
                                            <TextBlock Grid.Column="1" Text="{Binding LicenseType}" FontSize="12" FontWeight="Bold" />
                                        </Grid>

                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                            <syncfusion:ButtonAdv Label="Check Updates" Command="{Binding CheckUpdatesCommand}" Margin="0,0,10,0" />
                                            <syncfusion:ButtonAdv Label="View License" Command="{Binding ViewLicenseCommand}" Margin="0,0,10,0" />
                                            <syncfusion:ButtonAdv Label="About" Command="{Binding ShowAboutCommand}" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </ScrollViewer>
                    </DockPanel>
                </ContentControl>

            </syncfusion:DockingManager>
            <StatusBar DockPanel.Dock="Bottom" Style="{StaticResource WileyStatusBarStyle}">
                <StatusBarItem>
                    <TextBlock>
                        <Run Text="Current View: "/><Run Text="{Binding CurrentViewName, FallbackValue='Main Window'}" FontWeight="Bold" />
                    </TextBlock>
                </StatusBarItem>
                <Separator />
                <StatusBarItem>
                    <TextBlock>
                        <Run Text="Data Status: "/><Run Text="{Binding DataStatus, FallbackValue='Ready'}" />
                    </TextBlock>
                </StatusBarItem>
                <Separator />
                <StatusBarItem>
                    <TextBlock>
                        <Run Text="User: "/><Run Text="{Binding CurrentUserName, FallbackValue='Not signed in'}" FontWeight="Bold" />
                    </TextBlock>
                </StatusBarItem>
                <Separator />
                <StatusBarItem>
                    <TextBlock>
                        <Run Text="Items: "/><Run Text="{Binding Widgets.Count, Mode=OneWay}" />
                    </TextBlock>
                </StatusBarItem>
                <Separator />
                <!-- Transient status message area for brief notifications (e.g., paste results, theme changes) -->
                <StatusBarItem>
                    <TextBlock x:Name="StatusTextBlock" Text="Ready" Opacity="0.9"/>
                </StatusBarItem>
                <StatusBarItem HorizontalAlignment="Right">
                    <StackPanel Orientation="Horizontal">
                        <Button Content="🏠" ToolTip="Dashboard" Command="{Binding OpenDashboardCommand}"
                              Style="{StaticResource WileySecondaryButtonStyle}" Width="30" Margin="2,0" />
                        <Button Content="🏢" ToolTip="Enterprise" Command="{Binding OpenEnterpriseCommand}"
                              Style="{StaticResource WileySecondaryButtonStyle}" Width="30" Margin="2,0" />
                        <Button Content="💰" ToolTip="Budget" Command="{Binding OpenBudgetCommand}"
                              Style="{StaticResource WileySecondaryButtonStyle}" Width="30" Margin="2,0" />
                        <Button Content="🤖" ToolTip="AI Assistant" Command="{Binding OpenAIAssistCommand}"
                              Style="{StaticResource WileySecondaryButtonStyle}" Width="30" Margin="2,0" />
                    </StackPanel>
                </StatusBarItem>
            </StatusBar>
        </DockPanel>
    </DockPanel>
</Window>
