<Window x:Class="WileyWidget.DashboardView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WileyWidget"
        xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
        mc:Ignorable="d"
        Title="Dashboard" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <local:BudgetProgressConverter x:Key="BudgetProgressConverter" />
    </Window.Resources>

    <DockPanel>
        <!-- Ribbon Toolbar -->
        <syncfusion:Ribbon DockPanel.Dock="Top" x:Name="DashboardRibbon">
            <syncfusion:RibbonTab Caption="Dashboard">
                <syncfusion:RibbonBar Header="Actions">
                    <syncfusion:RibbonButton Label="Refresh" SizeForm="Large" Command="{Binding RefreshDashboardCommand}" />
                    <syncfusion:RibbonButton Label="Export" Command="{Binding ExportDashboardCommand}" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="View">
                    <syncfusion:RibbonButton Label="Auto Refresh" Command="{Binding ToggleAutoRefreshCommand}" />
                    <Label Content="Interval:" VerticalAlignment="Center" />
                    <syncfusion:IntegerTextBox Value="{Binding RefreshIntervalMinutes, Mode=TwoWay}"
                                             Width="60" Margin="5,0" />
                    <Label Content="minutes" VerticalAlignment="Center" />
                </syncfusion:RibbonBar>
            </syncfusion:RibbonTab>
        </syncfusion:Ribbon>

        <!-- Main Dashboard Content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
            <StackPanel Margin="10">
                <!-- KPI Summary Cards -->
                <WrapPanel Margin="0,0,0,20" Orientation="Horizontal">
                    <!-- Total Enterprises -->
                    <Border Background="#E3F2FD" BorderBrush="#1976D2" BorderThickness="2"
                            CornerRadius="8" Margin="0,0,15,15" Padding="15" MinWidth="200">
                        <StackPanel>
                            <TextBlock Text="Total Enterprises" FontSize="14" FontWeight="Bold" Foreground="#1976D2" />
                            <TextBlock Text="{Binding TotalEnterprises}" FontSize="32" FontWeight="Bold"
                                     Foreground="#1976D2" Margin="0,5,0,0" />
                            <TextBlock Text="{Binding EnterprisesChangeText}" FontSize="12"
                                     Foreground="{Binding EnterprisesChangeColor}" Margin="0,5,0,0" />
                        </StackPanel>
                    </Border>

                    <!-- Total Budget -->
                    <Border Background="#F3E5F5" BorderBrush="#7B1FA2" BorderThickness="2"
                            CornerRadius="8" Margin="0,0,15,15" Padding="15" MinWidth="200">
                        <StackPanel>
                            <TextBlock Text="Total Budget" FontSize="14" FontWeight="Bold" Foreground="#7B1FA2" />
                            <TextBlock Text="{Binding TotalBudget, StringFormat=C0}" FontSize="32" FontWeight="Bold"
                                     Foreground="#7B1FA2" Margin="0,5,0,0" />
                            <TextBlock Text="{Binding BudgetChangeText}" FontSize="12"
                                     Foreground="{Binding BudgetChangeColor}" Margin="0,5,0,0" />
                        </StackPanel>
                    </Border>

                    <!-- Active Projects -->
                    <Border Background="#E8F5E8" BorderBrush="#388E3C" BorderThickness="2"
                            CornerRadius="8" Margin="0,0,15,15" Padding="15" MinWidth="200">
                        <StackPanel>
                            <TextBlock Text="Active Projects" FontSize="14" FontWeight="Bold" Foreground="#388E3C" />
                            <TextBlock Text="{Binding ActiveProjects}" FontSize="32" FontWeight="Bold"
                                     Foreground="#388E3C" Margin="0,5,0,0" />
                            <TextBlock Text="{Binding ProjectsChangeText}" FontSize="12"
                                     Foreground="{Binding ProjectsChangeColor}" Margin="0,5,0,0" />
                        </StackPanel>
                    </Border>

                    <!-- System Health -->
                    <Border Background="#FFF3E0" BorderBrush="#F57C00" BorderThickness="2"
                            CornerRadius="8" Margin="0,0,15,15" Padding="15" MinWidth="200">
                        <StackPanel>
                            <TextBlock Text="System Health" FontSize="14" FontWeight="Bold" Foreground="#F57C00" />
                            <TextBlock Text="{Binding SystemHealthStatus}" FontSize="24" FontWeight="Bold"
                                     Foreground="{Binding SystemHealthColor}" Margin="0,5,0,0" />
                            <TextBlock Text="{Binding HealthScore, StringFormat={}{0}%}" FontSize="16"
                                     Foreground="#F57C00" Margin="0,5,0,0" />
                        </StackPanel>
                    </Border>
                </WrapPanel>

                <!-- Charts and Analytics Section -->
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Budget Trend Chart -->
                    <GroupBox Header="Budget Trends" Margin="0,0,10,0" Padding="10">
                        <syncfusion:SfChart Height="200">
                            <syncfusion:SfChart.PrimaryAxis>
                                <syncfusion:CategoryAxis />
                            </syncfusion:SfChart.PrimaryAxis>
                            <syncfusion:SfChart.SecondaryAxis>
                                <syncfusion:NumericalAxis LabelFormat="C0" />
                            </syncfusion:SfChart.SecondaryAxis>
                            <syncfusion:LineSeries ItemsSource="{Binding BudgetTrendData}"
                                                 XBindingPath="Period"
                                                 YBindingPath="Amount"
                                                 Interior="#2196F3" />
                        </syncfusion:SfChart>
                    </GroupBox>

                    <!-- Enterprise Distribution -->
                    <GroupBox Header="Enterprise Distribution" Margin="10,0,0,0" Padding="10">
                        <syncfusion:SfChart Height="200">
                            <syncfusion:SfChart.Legend>
                                <syncfusion:ChartLegend />
                            </syncfusion:SfChart.Legend>
                            <syncfusion:PieSeries ItemsSource="{Binding EnterpriseTypeData}"
                                                 XBindingPath="Type"
                                                 YBindingPath="Count"
                                                 Label="Type"
                                                 ExplodeAll="True"
                                                 ExplodeRadius="10" />
                        </syncfusion:SfChart>
                    </GroupBox>
                </Grid>

                <!-- Recent Activity and Alerts -->
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Recent Activity -->
                    <GroupBox Header="Recent Activity" Margin="0,0,10,0" Padding="10">
                        <ListView ItemsSource="{Binding RecentActivities}" Height="200">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Time" Width="100" DisplayMemberBinding="{Binding Timestamp, StringFormat=HH:mm}" />
                                    <GridViewColumn Header="Activity" Width="200" DisplayMemberBinding="{Binding Description}" />
                                    <GridViewColumn Header="Type" Width="80" DisplayMemberBinding="{Binding Type}" />
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </GroupBox>

                    <!-- System Alerts -->
                    <GroupBox Header="System Alerts" Margin="10,0,0,0" Padding="10">
                        <ListView ItemsSource="{Binding SystemAlerts}" Height="200">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Priority" Width="80">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Priority}"
                                                         Foreground="{Binding PriorityColor}" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Alert" Width="200" DisplayMemberBinding="{Binding Message}" />
                                    <GridViewColumn Header="Time" Width="100" DisplayMemberBinding="{Binding Timestamp, StringFormat=HH:mm}" />
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </GroupBox>
                </Grid>

                <!-- Quick Actions -->
                <GroupBox Header="Quick Actions" Padding="10">
                    <WrapPanel>
                        <syncfusion:ButtonAdv Content="Add Enterprise"
                                          Command="{Binding OpenEnterpriseManagementCommand}"
                                          Margin="0,0,10,10" />
                        <syncfusion:ButtonAdv Content="Budget Analysis"
                                          Command="{Binding OpenBudgetAnalysisCommand}"
                                          Margin="0,0,10,10" />
                        <syncfusion:ButtonAdv Content="Settings"
                                          Command="{Binding OpenSettingsCommand}"
                                          Margin="0,0,10,10" />
                        <syncfusion:ButtonAdv Content="Generate Report"
                                          Command="{Binding GenerateReportCommand}"
                                          Margin="0,0,10,10" />
                        <syncfusion:ButtonAdv Content="Backup Data"
                                          Command="{Binding BackupDataCommand}"
                                          Margin="0,0,10,10" />
                    </WrapPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>

        <!-- Status Bar -->
        <StatusBar DockPanel.Dock="Bottom" Background="Transparent">
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Last Updated: "/><Run Text="{Binding LastUpdated}" />
                </TextBlock>
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Status: "/><Run Text="{Binding DashboardStatus}" />
                </TextBlock>
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Next Refresh: "/><Run Text="{Binding NextRefreshTime}" />
                </TextBlock>
            </StatusBarItem>
        </StatusBar>
    </DockPanel>
</Window>