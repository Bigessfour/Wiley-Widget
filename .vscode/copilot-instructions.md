# WileyWidget Copilot Instructions## üìö **DOCUMENTATION DISCIPLINE - HIGHEST PRIORITY**### **MANDATORY Documentation Organization****CRITICAL REQUIREMENT**: ALL responses MUST reference the organized documentation structure:```docs/‚îú‚îÄ‚îÄ azure/          # Azure setup, safety, integration guides‚îú‚îÄ‚îÄ cicd/           # CI/CD pipelines, tools, processes‚îú‚îÄ‚îÄ testing/        # Testing frameworks and procedures‚îî‚îÄ‚îÄ general/        # Project guides and development resources```**Documentation Reference Rules:**- ‚úÖ **ALWAYS reference organized docs** - Never suggest creating new docs- ‚úÖ **Use current paths** - `docs/azure/azure-setup.md`, not old paths- ‚úÖ **Cross-reference related docs** - Link to relevant documentation- ‚úÖ **Cite partnership journey** - Reference `docs/general/OUR_PARTNERSHIP_JOURNEY.md`- ‚úÖ **Follow north star vision** - Align with `docs/general/wiley-widget-north-star-v1.1.md`**FORBIDDEN Documentation Practices:**- ‚ùå **Don't create duplicate docs** - Use existing organized structure- ‚ùå **Don't reference old paths** - Use new organized paths only- ‚ùå **Don't ignore documentation** - Always reference relevant docs- ‚ùå **Don't create new docs** - Use existing organized categories### **Documentation Discipline Checklist****BEFORE providing ANY assistance:**1. **Reference organized docs** - Check `docs/README.md` for current structure2. **Cite partnership journey** - Reference our collaboration story3. **Align with north star** - Ensure suggestions match project vision4. **Cross-reference related areas** - Link Azure, CI/CD, testing, general docs5. **Use current valid procedures** - Reference up-to-date documentation**Example Documentation Reference Pattern:**```Based on our partnership journey (docs/general/OUR_PARTNERSHIP_JOURNEY.md):- For Azure setup: See docs/azure/azure-setup.md- For CI/CD: See docs/cicd/CI-CD-README.md- For testing: See docs/testing/TESTING.md- For project vision: See docs/general/wiley-widget-north-star-v1.1.md```### **Documentation Discipline Enforcement Rules****MANDATORY for ALL responses:**1. **Start with documentation reference** - Always cite relevant organized docs first2. **Use current paths only** - Never reference old documentation locations3. **Cross-reference related areas** - Link Azure + CI/CD + testing + general docs4. **Cite partnership context** - Reference OUR_PARTNERSHIP_JOURNEY.md for collaboration5. **Align with north star** - Ensure suggestions match wiley-widget-north-star-v1.1.md6. **Prevent documentation drift** - Never suggest creating new docs outside organized structure**Documentation Quality Standards:**- ‚úÖ **Current and valid** - Only reference up-to-date procedures- ‚úÖ **Cross-referenced** - Include links to related documentation- ‚úÖ **Organized** - Use categorized structure (azure/, cicd/, testing/, general/)- ‚úÖ **Partnership-aligned** - Reflect our collaboration journey and vision- ‚úÖ **No duplicates** - Use existing docs, don't create new ones## üîß **MCP SERVER TOOLS - MANDATORY USAGE**### **MCP Server Configuration - HIGHEST PRIORITY****CRITICAL REQUIREMENT**: ALL external data requests, web searches, and API calls MUST use configured MCP servers exclusively.**MANDATORY MCP Server Usage:**- ‚úÖ **GitHub MCP Server**: For ALL GitHub API calls, repository searches, and GitHub data- ‚úÖ **Azure MCP Server**: For ALL Azure resource queries, Azure CLI operations, and Azure data- ‚úÖ **Microsoft Docs MCP Server**: For ALL Microsoft documentation searches and technical references**FORBIDDEN Direct Usage:**- ‚ùå **No direct GitHub API calls** - Use GitHub MCP Server only- ‚ùå **No direct Azure CLI commands** - Use Azure MCP Server only- ‚ùå **No direct Microsoft Learn searches** - Use Microsoft Docs MCP Server only- ‚ùå **No manual curl/wget commands** - Use appropriate MCP server only### **MCP Server Autostart & Persistence****AUTOMATIC CONFIGURATION**: MCP servers start automatically on VS Code launch with persistence enabled.**Current Validated Configuration:**```json      "microsoft-docs": { "url": "https://learn.microsoft.com/mcp/", "type": "http" }```**MCP Server Validation Commands:**```powershell# Test all MCP server connections.\scripts\test-mcp-connections.ps1 -TestAll# Validate MCP persistence and autostart.\scripts\validate-mcp-persistence.ps1 -TestPersistence -TestAutostart -ValidateEnvironment```### **MCP Usage Patterns - STRICTLY ENFORCED****GitHub Operations:**```javascript// ‚úÖ CORRECT: Use GitHub MCP Servermcp_github_list_issues({ owner: "microsoft", repo: "vscode" })mcp_github_search_code({ q: "repository", repo: "microsoft/vscode" })// ‚ùå FORBIDDEN: Direct GitHub API callsfetch('https://api.github.com/repos/microsoft/vscode/issues')```**Azure Operations:**```javascript// ‚úÖ CORRECT: Use Azure MCP Serverazure_resources-query_azure_resource_graph({ arg_intent: "list all VMs" })azure_auth-get_auth_state()// ‚ùå FORBIDDEN: Direct Azure CLIaz vm list```**Web Search & Scraping:**```javascript// ‚úÖ CORRECT: Use Microsoft Docs MCP Server for documentation// ‚ùå FORBIDDEN: Direct web scraping or search engine queries```**Microsoft Documentation:**```javascript// ‚úÖ CORRECT: Use Microsoft Docs MCP Servermcp_microsoft_doc_microsoft_docs_search({ query: ".NET Core best practices" })mcp_microsoft_doc_microsoft_docs_fetch({ url: "https://learn.microsoft.com/dotnet/core/" })// ‚ùå FORBIDDEN: Direct searchessearch "site:learn.microsoft.com .NET Core"```### **MCP Server Health Monitoring****MANDATORY Health Checks:**- **Daily validation**: Run MCP connection tests daily- **Pre-development**: Validate MCP servers before starting work- **Post-configuration**: Test after any MCP configuration changes- **Error troubleshooting**: Use MCP validation scripts for debugging**MCP Server Status Indicators:**- ‚úÖ **EXCELLENT**: 100% success rate, all servers operational- ‚úÖ **GOOD**: 75-99% success rate, minor issues- ‚ö†Ô∏è **NEEDS ATTENTION**: Below 75% success rate, requires fixes- ‚ùå **CRITICAL**: Server failures, immediate attention required### **MCP Integration Rules****MANDATORY for ALL responses:**1. **Use MCP servers exclusively** - Never suggest direct API calls or CLI commands2. **Validate MCP status first** - Check server health before suggesting usage3. **Reference MCP configuration** - Cite current MCP setup and validation results4. **Provide MCP examples** - Include proper MCP server usage patterns5. **Test MCP operations** - Suggest validation after MCP server usage**MCP Server Priority Order:**1. **GitHub MCP**: Primary for repository and GitHub data operations2. **Azure MCP**: Primary for Azure resource and service operations3. **Microsoft Docs MCP**: Primary for Microsoft documentation and learning**Example MCP Response Pattern:**```Based on our MCP server configuration (100% validated):For GitHub operations:```javascriptmcp_github_list_issues({ owner: "your-org", repo: "your-repo" })```For Azure queries:```javascriptazure_resources-query_azure_resource_graph({ arg_intent: "list SQL databases" })```For documentation searches:```javascriptmcp_microsoft_doc_microsoft_docs_search({ query: "EF Core best practices" })```Remember: All external operations use MCP servers exclusively for security and consistency.```## ÔøΩ **AZURE SAFETY FIRST - CRITICAL FOR NOVICE USERS**### **Azure Development Safety Protocol****HIGHEST PRIORITY**: User is a novice Azure developer who has experienced database crashes. All Azure assistance must prioritize safety and education.**MANDATORY Safety Rules:**- **NEVER suggest direct Azure CLI commands** without safe script alternatives- **ALWAYS recommend dry-run mode** for any potentially destructive operations- **REQUIRE explicit confirmation** for any database or resource modifications- **USE safe scripts exclusively** for all Azure operations- **EXPLAIN every command** before suggesting execution- **CREATE backups automatically** before any schema changes- **PROVIDE learning context** for all Azure concepts**Safe Azure Workflow:**```powershell# 1. Always check status first (safe, read-only).\scripts\azure-safe-operations.ps1 -Operation status# 2. Test operations with dry-run (see what would happen).\scripts\azure-safe-operations.ps1 -Operation [operation] -DryRun# 3. Execute only after understanding and testing.\scripts\azure-safe-operations.ps1 -Operation [operation]```**FORBIDDEN Direct Commands:**- ‚ùå `az sql db delete` ‚Üí Use safe script instead- ‚ùå `az group delete` ‚Üí Use safe script instead- ‚ùå `az resource delete` ‚Üí Use safe script instead- ‚ùå Any command with `--force` or `--yes` flags**REQUIRED Safe Alternatives:**- ‚úÖ `.\scripts\azure-safe-operations.ps1 -Operation status`- ‚úÖ `.\scripts\azure-safe-operations.ps1 -Operation backup`- ‚úÖ `.\scripts\azure-safe-operations.ps1 -Operation list`### **Novice Developer Support**- **Explain Azure concepts** in simple, non-technical terms- **Provide learning resources** for each topic- **Suggest practice environments** for experimentation- **Offer step-by-step guidance** for complex operations- **Encourage questions** and admit when unsure- **Celebrate small victories** and progress**Example Safe Response Pattern:**```I see you're new to Azure - that's awesome! Let's do this safely:1. **Check your current setup** (completely safe):   ```powershell   .\scripts\azure-safe-operations.ps1 -Operation status   ```2. **Test what you want to do** (see what would happen):   ```powershell   .\scripts\azure-safe-operations.ps1 -Operation connect -DryRun   ```3. **Learn what this means** (I'll explain each step)Remember: You can always ask me "What does this Azure thing do?" and I'll explain it simply!```## üìä **QUICKBOOKS ONLINE INTEGRATION REFERENCE**### **Complete API Documentation****MANDATORY REFERENCE**: All QuickBooks Online development MUST reference [QuickBooks Integration.md](../QuickBooks%20Integration.md) for:- **Official API endpoints** and request/response formats- **Authentication patterns** (OAuth 2.0 with Bearer tokens)- **Rate limits** and error handling strategies- **SDK usage** (Intuit .NET SDK v3)- **Municipal accounting** implementation patterns- **Testing procedures** and troubleshooting guides### **Key Integration Points**- **Classes API**: For fund tracking (WaterFund, SewerFund, etc.)- **Accounts API**: For expense/revenue categorization- **Customers API**: For municipal customer management- **Invoices API**: For billing and rate collection- **Batch Operations**: For efficient bulk updates### **Implementation Standards**- **Use SDK**: Always prefer Intuit .NET SDK over raw HTTP calls- **Token Management**: Implement automatic refresh before expiration- **Error Handling**: Handle 401 (reauth), 429 (rate limit), 400 (validation) errors- **Sandbox First**: Test all operations in sandbox environment- **Logging**: Log all API calls and responses for debugging### **Reference Pattern**```csharp// Always reference the integration guide for proper implementation// See: QuickBooks Integration.md for complete endpoint documentation```## ÔøΩüîß **TECHNOLOGY STANDARDS - STRICTLY ENFORCED**### **Syncfusion WPF - VERSION 30.2.7 ONLY****CRITICAL REQUIREMENT**: ALL Syncfusion usage MUST reference version 30.2.7 exclusively.**Enforced Rules:**- **Version Lock**: Use ONLY Syncfusion WPF 30.2.7 packages and documentation- **No Other Versions**: Do NOT reference or suggest any other Syncfusion versions- **Documentation Source**: Reference ONLY official Syncfusion 30.2.7 documentation- **Package Enforcement**: All code must use 30.2.7 package versions- **Control Library**: Use ONLY Syncfusion.Tools.WPF 30.2.7 for advanced controls- **Data Components**: Use ONLY Syncfusion.SfGrid.WPF 30.2.7 for data grids- **Theming**: Use ONLY Syncfusion.SfSkinManager.WPF 30.2.7 for theme management**FORBIDDEN**: Any reference to older versions (30.2.4, etc.) or newer versions### **Theme System - FluentDark & FluentLight ONLY****MANDATORY THEME REQUIREMENTS:****Standard Themes (ONLY THESE TWO):**- **FluentDark**: Required primary dark theme- **FluentLight**: Required alternative light theme**Theme Implementation Rules:**- **Live Switching**: Implement theme switching capability using SfSkinManager- **Persistence**: Theme selection must be persisted in user settings- **Proper Application**: Use SfSkinManager.SetTheme() method from 30.2.7- **No Custom Themes**: Do NOT create or suggest custom themes- **UI Integration**: Theme toggle must be available in ribbon/settings**Required Code Pattern:**```csharp// ONLY use Syncfusion.SfSkinManager.WPF 30.2.7using Syncfusion.SfSkinManager;// Apply FluentDark (required)SfSkinManager.SetTheme(this, new FluentDarkTheme());// Apply FluentLight (required)SfSkinManager.SetTheme(this, new FluentLightTheme());```### **UI Component Standards****Ribbon Control:**- Use ONLY Syncfusion.Tools.WPF 30.2.7 RibbonControlAdv- Implement tabbed navigation following 30.2.7 patterns- Reference official 30.2.7 documentation exclusively**DataGrid:**- Use ONLY Syncfusion.SfGrid.WPF 30.2.7 SfDataGrid- Implement CRUD operations following 30.2.7 patterns- Reference official 30.2.7 documentation exclusively**Dynamic Resources:**- Use ONLY Syncfusion 30.2.7 resource dictionaries- Ensure theme-aware resource loading- Follow 30.2.7 resource management patterns## Key Guidelines- **Languages/Tools**: C# for core, XAML for UI, PowerShell for scripts (use proper modules, no Write-Host except traces). Suggest VS Code extensions: PowerShell Tools, Trunk (for linting/code quality), C# Dev Kit.- **Best Practices**: Nullable refs disabled for now (enable later). Use Serilog for logging. Persist settings in JSON via SettingsService. Ensure 70%+ test coverage (NUnit).- **Azure Integration**: Use EF Core with Microsoft.EntityFrameworkCore.SqlServer. **Azure Managed Identity is RECOMMENDED for production** (automatic token rotation, no stored credentials). Use connection strings for development only. Reference Microsoft Docs: https://learn.microsoft.com/en-us/ef/core/ and Azure SQL guides.- **GitHub Copilot Alignment**: Suggest code from GitHub docs (e.g., Actions for CI). Use Trunk checks in workflows. Avoid overkill‚Äîkeep it 1-person simple.- **UI/Features**: Syncfusion only‚Äîno custom controls yet. Add live theme switching. Roadmap: UI automation, signing/updater.- **Code Style**: Follow .editorconfig. MVVM strict‚Äîno code-behind logic. Suggest tests for every feature.- **Fetchability**: Reference fetchability-resources.json for file integrity in scripts/CI.## Project Vision & Roadmap**CRITICAL**: Always reference `.vscode/project-plan.md` for the True North vision and phased roadmap. This document contains:- Complete project vision and success criteria- Detailed 6-phase roadmap with current priorities- Technology stack and development constraints- Risk mitigation strategies- Success metrics and quality standards**When suggesting code or features**:1. Check current phase in project-plan.md2. Align suggestions with phase goals and success criteria3. Consider solo-developer workflow optimization4. Prioritize features that support the current phase5. Reference appropriate external documentation**Development Priorities** (from project plan):- Phase 1 (Current): Foundation & Scaffold ‚úÖ- Phase 2 (Next): Data Layer Integration üîÑ - **NOW ACTIVE**- Phase 3 (Planned): Enhanced UI Features üìã- Phase 4-6: Future integrations and polish**Phase 2 Focus Areas**:- **Database Models**: Create AppDbContext, Widget entity with proper EF Core configuration- **Repository Pattern**: Implement IWidgetRepository with async CRUD operations- **Connection Management**: **Configure Azure SQL with Azure Managed Identity (RECOMMENDED)** or connection strings for development- **Migration Strategy**: Code-first approach with initial migration- **Error Handling**: Comprehensive exception handling and logging- **Testing**: Unit tests for repository, integration tests for database operations- **Security**: Implement Azure Managed Identity for production authentication**Reference docs/database-connection-methods-reference.md** for complete implementation details including:- Azure Managed Identity setup (RECOMMENDED for production)- Migration guides from password authentication- Security best practices and compliance requirements- Stable package versions (EF Core 9.0.0, Azure.Identity 1.13.0)- DbContext configuration with retry logic- Repository pattern implementation- Connection string security (UserSecrets for dev, managed identity for prod)- Migration commands and best practices- Testing setup with in-memory databaseWhen suggesting, prioritize: Simplicity, security (encrypt tokens), and alignment with project-plan.md vision.## üßπ **CODING STANDARDS & FILE MANAGEMENT**### **File Management and Cleanup Best Practices**#### **Temporary File Cleanup**Always clean up temporary files created during development:- **Remove `.new`, `.bak`, `.backup`, `.old` files** after successful operations- **Delete `*_temp`, `*_tmp`, `*_test` files** when no longer needed- **Clean up `Migration_Backups/` directories** after migration completion- **Remove duplicate files** (e.g., `file.cs` and `file_new.cs`)#### **Files to Always Remove**- Build artifacts: `bin/`, `obj/`, `TestResults/`- IDE files: `.vs/`, `*.user`, `*.suo`- Temporary downloads: `*.crdownload`, `*.tmp`- Backup files: `*.backup_*`, `*_backup*`- Empty directories that serve no purpose#### **Code Formatting Standards**- **No trailing whitespace** - remove spaces/tabs at line endings- **Consistent indentation** - use spaces or tabs consistently (prefer spaces)- **File endings** - ensure files end with exactly one newline- **Line length** - keep lines under 120 characters when practical- **Empty lines** - use sparingly and consistently for logical separation- **No nullable reference types** - avoid using nullable properties, parameters, or return types in new code#### **Problem Resolution Approach**- **Incremental fixes first** - Always attempt targeted edits before complete rebuilds- **Assess corruption level** - Check actual errors and their scope before deciding approach- **Minimal viable fix** - Use the smallest change that resolves the issue- **Hobby-friendly** - Prioritize getting things working over perfect architecture#### **PowerShell Standards**```powershell# Prefer approved verbs and proper error handlingfunction Get-ProjectStatus {    [CmdletBinding()]    param(        [Parameter(Mandatory)]        [string]$ProjectPath    )    try {        # Main logic        Write-Output $result    }    catch {        Write-Error "Failed: $_"        throw    }}```#### **Resource Management (Hobby-Friendly)**```csharp// Good: Simple resource managementusing var connection = new SqlConnection(connectionString);// Acceptable: Framework-managed resources (with pragma if needed)#pragma warning disable CA2000 // Theme objects managed by SfSkinManagerSfSkinManager.SetTheme(this, new Theme("FluentLight"));#pragma warning restore CA2000// Good: Simple error handling for hobby projectstry{    await operation();}catch (SpecificException ex){    _logger.LogWarning("Operation failed: {Message}", ex.Message);}```
