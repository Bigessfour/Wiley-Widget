<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <!-- Updated TFM for SDK 1.5+ compatibility: Win11 22H2 baseline unlocks modern APIs -->
    <TargetFramework>net9.0-windows10.0.26100.0</TargetFramework>
    <TargetPlatformMinVersion>10.0.17763.0</TargetPlatformMinVersion>
    <RootNamespace>WileyWidget</RootNamespace>
    <UseWinUI>true</UseWinUI>
    <Nullable>enable</Nullable>
    <WindowsPackageType>None</WindowsPackageType>
    <WarningsNotAsErrors>NU1605</WarningsNotAsErrors>
    
    <!-- CRITICAL: Disable all MSIX/packaging functionality -->
    <EnableMsixTooling>false</EnableMsixTooling>
    <AppxPackage>false</AppxPackage>
    <GenerateAppxPackageOnBuild>false</GenerateAppxPackageOnBuild>
    <AppxGeneratePriEnabled>false</AppxGeneratePriEnabled>
    <GenerateLibraryLayout>true</GenerateLibraryLayout>
    <DisableXbfGeneration>false</DisableXbfGeneration>
    <GenerateProjectPriFile>false</GenerateProjectPriFile>
    <GenerateAppInstallerFile>false</GenerateAppInstallerFile>
    <AppxAutoIncrementPackageRevision>false</AppxAutoIncrementPackageRevision>
    <AppxBundle>Never</AppxBundle>
    <AppxBundlePlatforms></AppxBundlePlatforms>
    <DisableXbfLineInfo>true</DisableXbfLineInfo>
    <AppxGeneratePrisForPortableLibraries>false</AppxGeneratePrisForPortableLibraries>
    <GeneratePrisForMsix>false</GeneratePrisForMsix>
    <AppxPackageBuildMode>SideloadOnly</AppxPackageBuildMode>
    
    <!--  WORKAROUND: Prevent WindowsAppSDK from loading AppxPackage MSBuild task -->
    <UseSdkBuildToolsPackage>false</UseSdkBuildToolsPackage>
    
    <Platforms>x64</Platforms>
    <!-- Suppress WindowsAppSDK package-level RuntimeIdentifiers that inject unsupported RIDs.
         Using only RuntimeIdentifiers (plural) bypasses WindowsAppSDK 1.5.x XamlCompiler exit code 1
         when using explicit RuntimeIdentifier (singular). -->
    <RuntimeIdentifiers>win-x64</RuntimeIdentifiers>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Platform)'=='x64'">
    <PlatformTarget>x64</PlatformTarget>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Platform)'=='ARM64'">
    <PlatformTarget>ARM64</PlatformTarget>
  </PropertyGroup>

  <ItemGroup>
    <Content Include="Assets\\SplashScreen.scale-200.png" />
    <Content Include="Assets\\LockScreenLogo.scale-200.png" />
    <Content Include="Assets\\Square150x150Logo.scale-200.png" />
    <Content Include="Assets\\Square44x44Logo.scale-200.png" />
    <Content Include="Assets\\Square44x44Logo.targetsize-24_altform-unplated.png" />
    <Content Include="Assets\\StoreLogo.png" />
    <Content Include="Assets\\Wide310x150Logo.scale-200.png" />
  </ItemGroup>

  <ItemGroup>
    <!-- Pin to exact SDK 1.5 stable for compatibility; removes NU1603 warning -->
    <PackageReference Include="Microsoft.WindowsAppSDK" />
    <PackageReference Include="Microsoft.Extensions.Hosting" />
    <PackageReference Include="Microsoft.Extensions.DependencyInjection" />
    <!-- EF/Tools removed from UI project (move to data project) -->
    <!-- <PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer" /> -->
    <!-- <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" /> -->
    <!-- <PackageReference Include="Microsoft.Extensions.Configuration" /> -->
    <!-- <PackageReference Include="Microsoft.Extensions.Configuration.Json" /> -->
    <PackageReference Include="CommunityToolkit.Mvvm" />
    <PackageReference Include="Serilog" />
    <PackageReference Include="Serilog.Extensions.Hosting" />
    <PackageReference Include="Serilog.Sinks.Console" />
    <PackageReference Include="Serilog.Sinks.File" />
    <PackageReference Include="Serilog.Enrichers.Thread" />
    <PackageReference Include="Serilog.Enrichers.Environment" />
    <PackageReference Include="Serilog.Enrichers.Process" />
  </ItemGroup>

  <ItemGroup>
    <!-- <ProjectReference Include="src\\WileyWidget.Data\\WileyWidget.Data.csproj" /> -->
    <!-- <ProjectReference Include="src\\WileyWidget.Services.Uno\\WileyWidget.Services.Uno.csproj" /> -->
    <!-- <ProjectReference Include="src\\WileyWidget.Business\\WileyWidget.Business.csproj" /> -->
    <!-- <ProjectReference Include="src\\WileyWidget.Models\\WileyWidget.Models.csproj" /> -->
    <!-- <ProjectReference Include="src\\WileyWidget.Services.Abstractions\\WileyWidget.Services.Abstractions.csproj" /> -->
  </ItemGroup>

  <!-- Exclude custom projects and tests from main app build -->
  <ItemGroup>
    <Compile Remove="src\\**" />
    <Compile Remove="tests\\**" />
    <Compile Remove="WileyWidget.Services.UnitTests\\**" />
  </ItemGroup>

  <!-- Publish Properties -->
  <PropertyGroup>
    <PublishReadyToRun Condition="'$(Configuration)' == 'Debug'">False</PublishReadyToRun>
    <PublishReadyToRun Condition="'$(Configuration)' != 'Debug'">True</PublishReadyToRun>
    <PublishTrimmed Condition="'$(Configuration)' == 'Debug'">False</PublishTrimmed>
    <PublishTrimmed Condition="'$(Configuration)' != 'Debug'">True</PublishTrimmed>
  </PropertyGroup>
</Project>