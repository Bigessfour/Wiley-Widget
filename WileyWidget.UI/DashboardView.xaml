<UserControl x:Class="WileyWidget.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:WileyWidget.Converters"
             xmlns:behaviors="clr-namespace:WileyWidget.UI.Behaviors"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:gauge="clr-namespace:Syncfusion.UI.Xaml.Gauges;assembly=Syncfusion.SfGauge.Wpf"
             xmlns:chart="clr-namespace:Syncfusion.UI.Xaml.Charts;assembly=Syncfusion.SfChart.WPF"
             xmlns:grid="clr-namespace:Syncfusion.UI.Xaml.Grid;assembly=Syncfusion.SfGrid.WPF"
             xmlns:syncfusionskin="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
             xmlns:notification="clr-namespace:Syncfusion.Windows.Controls.Notification;assembly=Syncfusion.SfBusyIndicator.WPF"
             xmlns:darkTheme="clr-namespace:Syncfusion.Themes.FluentDark.WPF;assembly=Syncfusion.Themes.FluentDark.WPF"
             xmlns:prism="http://prismlibrary.com/"
             syncfusionskin:SfSkinManager.VisualStyle="FluentDark"
             mc:Ignorable="d"
             prism:ViewModelLocator.AutoWireViewModel="True">
    <UserControl.Resources>
        <local:BooleanToVisibilityConverter x:Key="BoolToVis" />
        <local:BudgetProgressConverter x:Key="BudgetProgressConverter" />
        <local:EmptyStringToVisibilityConverter x:Key="EmptyStringToVisibilityConverter" />
        <local:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />

        <!-- Trackball Line Style for Chart Interactivity -->
        <Style x:Key="TrackBallLineStyle" TargetType="Line">
            <Setter Property="Stroke" Value="#2196F3"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="StrokeDashArray" Value="3,3"/>
        </Style>
    </UserControl.Resources>

    <!-- Theme applied globally via SfSkinManager.ApplicationTheme in App.xaml.cs -->
    <!-- Reference: https://help.syncfusion.com/wpf/themes/skin-manager#apply-a-theme-globally-in-the-application -->
    <Grid behaviors:FocusOnLoadBehavior.IsEnabled="True" behaviors:FocusOnLoadBehavior.TargetName="DashboardFocusAnchor"
        behaviors:MouseFocusBehavior.EnableOnClick="True"
        behaviors:MouseFocusBehavior.EnableOnFirstMove="True">
        <!-- Invisible focus anchor to guarantee a focusable target (must be visible to receive focus) -->
    <Border x:Name="DashboardFocusAnchor" Focusable="True" Width="0" Height="0" Opacity="0" />
        <DockPanel>
        <!-- Ribbon Toolbar -->
        <syncfusion:Ribbon DockPanel.Dock="Top" x:Name="DashboardRibbon">
            <syncfusion:RibbonTab Caption="Dashboard">
                <syncfusion:RibbonBar Header="Actions">
                    <syncfusion:RibbonButton Label="Refresh" SizeForm="Large" Command="{Binding RefreshDashboardCommand}"
                                           IsEnabled="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter= invert}"
                                           ToolTipService.ToolTip="Refresh all dashboard data from QuickBooks Online and local database" />
                    <syncfusion:RibbonButton Label="Export" Command="{Binding ExportDashboardCommand}"
                                           IsEnabled="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter= invert}"
                                           ToolTipService.ToolTip="Export dashboard data to Excel or PDF format" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="View">
                    <syncfusion:RibbonButton Label="Auto Refresh" Command="{Binding ToggleAutoRefreshCommand}"
                                           IsEnabled="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter= invert}"
                                           ToolTipService.ToolTip="Toggle automatic dashboard refresh" />
                    <Label Content="Interval:" VerticalAlignment="Center" />
                    <syncfusion:IntegerTextBox Value="{Binding RefreshIntervalMinutes, Mode=TwoWay}"
                                             Width="60" Margin="5,0"
                                             IsEnabled="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter= invert}"
                                             ToolTipService.ToolTip="Set refresh interval in minutes (recommended: 5-15 minutes)" />
                    <Label Content="minutes" VerticalAlignment="Center" />
                </syncfusion:RibbonBar>
                <syncfusion:RibbonBar Header="Navigation">
                    <syncfusion:RibbonButton Label="Accounts" Command="{Binding NavigateToAccountsCommand}"
                                           ToolTipService.ToolTip="Navigate to Municipal Accounts view" />
                    <syncfusion:RibbonButton Label="Back" Command="{Binding NavigateBackCommand}"
                                           ToolTipService.ToolTip="Go back in navigation history" />
                    <syncfusion:RibbonButton Label="Forward" Command="{Binding NavigateForwardCommand}"
                                           ToolTipService.ToolTip="Go forward in navigation history" />
                </syncfusion:RibbonBar>
            </syncfusion:RibbonTab>
        </syncfusion:Ribbon>

        <!-- Loading Overlay -->
        <Grid Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}" Background="#80000000" DockPanel.Dock="Top" Height="4">
            <ProgressBar Value="{Binding ProgressPercentage}" Height="4" VerticalAlignment="Top"
                        Background="Transparent" Foreground="#2196F3" BorderThickness="0" />
        </Grid>

        <!-- Main Dashboard Content with Syncfusion Controls -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
            <StackPanel Margin="15">

                <!-- KPI Gauges Section - Visual Heavy Dashboard -->
                <TextBlock Text="Key Performance Indicators" FontSize="20" FontWeight="Bold" Margin="0,0,0,15" />

                <Grid Margin="0,0,0,25">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Budget Utilization Gauge -->
                    <Border Grid.Column="0" Background="#1E1E1E" BorderBrush="#2196F3" BorderThickness="2"
                            CornerRadius="8" Margin="5" Padding="10"
                            ToolTipService.ToolTip="Budget utilization percentage - shows how much of the total budget has been spent">
                        <StackPanel>
                            <TextBlock Text="Budget Utilization" FontSize="14" FontWeight="SemiBold"
                                     HorizontalAlignment="Center" Margin="0,0,0,10" Foreground="#2196F3"/>
                            <chart:SfChart Height="200" Width="200">
                                <chart:SfChart.PrimaryAxis>
                                    <chart:CategoryAxis />
                                </chart:SfChart.PrimaryAxis>
                                <chart:SfChart.SecondaryAxis>
                                    <chart:NumericalAxis />
                                </chart:SfChart.SecondaryAxis>
                                <chart:DoughnutSeries ItemsSource="{Binding BudgetUtilizationData}"
                                                     XBindingPath="Category"
                                                     YBindingPath="Value"
                                                     StartAngle="90"
                                                     EndAngle="450"
                                                     EnableAnimation="True" />
                            </chart:SfChart>
                            <TextBlock Text="{Binding BudgetUtilizationScore, StringFormat={}{0}%}"
                                     FontSize="24" FontWeight="Bold" HorizontalAlignment="Center"
                                     Foreground="#2196F3" Margin="0,5,0,0">
                                <TextBlock.ToolTip>
                                    <StackPanel>
                                        <TextBlock Text="{Binding BudgetUtilizationScore, StringFormat='Current utilization: {0}%'}" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding TotalBudget, StringFormat='Total Budget: {0:C0}'}" Margin="0,5,0,0"/>
                                        <TextBlock Text="{Binding SpentAmount, StringFormat='Spent: {0:C0}'}" Margin="0,2,0,0"/>
                                        <TextBlock Text="{Binding RemainingBudget, StringFormat='Remaining: {0:C0}'}" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </TextBlock.ToolTip>
                            </TextBlock>
                            <TextBlock Text="{Binding TotalBudget, StringFormat='Total: {0:C0}'}"
                                     FontSize="12" HorizontalAlignment="Center" Foreground="#B0B0B0"/>
                        </StackPanel>
                    </Border>

                    <!-- System Health Gauge -->
                    <Border Grid.Column="1" Background="#1E1E1E" BorderBrush="#4CAF50" BorderThickness="2"
                            CornerRadius="8" Margin="5" Padding="10"
                            ToolTipService.ToolTip="System health score based on data quality, API connectivity, and performance metrics">
                        <StackPanel>
                            <TextBlock Text="System Health" FontSize="14" FontWeight="SemiBold"
                                     HorizontalAlignment="Center" Margin="0,0,0,10" Foreground="#4CAF50"/>
                            <gauge:SfCircularGauge Height="200" Width="200">
                                <gauge:SfCircularGauge.Scales>
                                    <gauge:CircularScale StartValue="0" EndValue="100" Interval="10"
                                                       RimStroke="#4CAF50" RimStrokeThickness="3">
                                        <gauge:CircularScale.Ranges>
                                            <gauge:CircularRange StartValue="0" EndValue="50" Stroke="#F44336"/>
                                            <gauge:CircularRange StartValue="50" EndValue="75" Stroke="#FFC107"/>
                                            <gauge:CircularRange StartValue="75" EndValue="100" Stroke="#4CAF50"/>
                                        </gauge:CircularScale.Ranges>
                                        <gauge:CircularScale.Pointers>
                                            <gauge:CircularPointer PointerType="NeedlePointer"
                                                                 Value="{Binding SystemHealthScore}"
                                                                 NeedleLengthFactor="0.6"
                                                                 NeedlePointerType="Triangle"
                                                                 NeedlePointerStroke="#4CAF50"
                                                                 NeedlePointerStrokeThickness="5"
                                                                 EnableAnimation="True"
                                                                 />
                                        </gauge:CircularScale.Pointers>
                                    </gauge:CircularScale>
                                </gauge:SfCircularGauge.Scales>
                            </gauge:SfCircularGauge>
                            <TextBlock Text="{Binding SystemHealthStatus}" FontSize="24" FontWeight="Bold"
                                     HorizontalAlignment="Center" Foreground="#4CAF50" Margin="0,5,0,0">
                                <TextBlock.ToolTip>
                                    <StackPanel>
                                        <TextBlock Text="{Binding SystemHealthScore, StringFormat='Health score: {0}%'}" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding SystemHealthStatus, StringFormat='Status: {0}'}" Margin="0,5,0,0"/>
                                        <TextBlock Text="0-50: Critical - Immediate attention required" Margin="0,5,0,0" Foreground="#F44336"/>
                                        <TextBlock Text="50-75: Warning - Performance degraded" Margin="0,2,0,0" Foreground="#FFC107"/>
                                        <TextBlock Text="75-100: Healthy - System operating normally" Margin="0,2,0,0" Foreground="#4CAF50"/>
                                    </StackPanel>
                                </TextBlock.ToolTip>
                            </TextBlock>
                            <TextBlock Text="{Binding SystemHealthScore, StringFormat='{}{0}% Score'}"
                                     FontSize="12" HorizontalAlignment="Center" Foreground="#B0B0B0"/>
                        </StackPanel>
                    </Border>

                    <!-- Enterprise Count Display -->
                    <Border Grid.Column="2" Background="#1E1E1E" BorderBrush="#9C27B0" BorderThickness="2"
                            CornerRadius="8" Margin="5" Padding="10"
                            ToolTipService.ToolTip="Total number of enterprise funds tracked across all departments">
                        <StackPanel>
                            <TextBlock Text="Total Enterprises" FontSize="14" FontWeight="SemiBold"
                                     HorizontalAlignment="Center" Margin="0,0,0,10" Foreground="#9C27B0"/>
                            <gauge:SfCircularGauge Height="200" Width="200">
                                <gauge:SfCircularGauge.Scales>
                                    <gauge:CircularScale StartValue="0" EndValue="100" Interval="20"
                                                       RimStroke="#9C27B0" RimStrokeThickness="3">
                                        <gauge:CircularScale.Pointers>
                                            <gauge:CircularPointer PointerType="RangePointer"
                                                                 Value="{Binding TotalEnterprises}"
                                                                 RangePointerStroke="#9C27B0"
                                                                 RangePointerStrokeThickness="20"
                                                                 EnableAnimation="True" />
                                        </gauge:CircularScale.Pointers>
                                    </gauge:CircularScale>
                                </gauge:SfCircularGauge.Scales>
                            </gauge:SfCircularGauge>
                            <TextBlock Text="{Binding TotalEnterprises}" FontSize="32" FontWeight="Bold"
                                     HorizontalAlignment="Center" Foreground="#9C27B0" Margin="0,5,0,0"
                                     ToolTipService.ToolTip="Total enterprise funds being monitored"/>
                            <TextBlock Text="{Binding EnterprisesChangeText}" FontSize="12"
                                     HorizontalAlignment="Center" Foreground="#B0B0B0"
                                     ToolTipService.ToolTip="Change in enterprise count compared to last period"/>
                        </StackPanel>
                    </Border>

                    <!-- Active Projects Display -->
                    <Border Grid.Column="3" Background="#1E1E1E" BorderBrush="#FF9800" BorderThickness="2"
                            CornerRadius="8" Margin="5" Padding="10"
                            ToolTipService.ToolTip="Number of currently active municipal projects and initiatives">
                        <StackPanel>
                            <TextBlock Text="Active Projects" FontSize="14" FontWeight="SemiBold"
                                     HorizontalAlignment="Center" Margin="0,0,0,10" Foreground="#FF9800"/>
                            <gauge:SfCircularGauge Height="200" Width="200">
                                <gauge:SfCircularGauge.Scales>
                                    <gauge:CircularScale StartValue="0" EndValue="50" Interval="10"
                                                       RimStroke="#FF9800" RimStrokeThickness="3">
                                        <gauge:CircularScale.Pointers>
                                            <gauge:CircularPointer PointerType="SymbolPointer"
                                                                 Value="{Binding ActiveProjects}"
                                                                 Symbol="InvertedTriangle"
                                                                 SymbolPointerHeight="15"
                                                                 SymbolPointerWidth="15"
                                                                 SymbolPointerStroke="#FF9800"
                                                                 EnableAnimation="True" />
                                        </gauge:CircularScale.Pointers>
                                    </gauge:CircularScale>
                                </gauge:SfCircularGauge.Scales>
                            </gauge:SfCircularGauge>
                            <TextBlock Text="{Binding ActiveProjects}" FontSize="32" FontWeight="Bold"
                                     HorizontalAlignment="Center" Foreground="#FF9800" Margin="0,5,0,0"
                                     ToolTipService.ToolTip="Total active projects in progress"/>
                            <TextBlock Text="{Binding ProjectsChangeText}" FontSize="12"
                                     HorizontalAlignment="Center" Foreground="#B0B0B0"
                                     ToolTipService.ToolTip="Change in active projects compared to last period"/>
                        </StackPanel>
                    </Border>
                </Grid>

                <TextBlock Text="{Binding SuggestedRate}"
                           FontSize="16" FontWeight="SemiBold"
                           HorizontalAlignment="Center" Margin="0,20,0,0"
                           Foreground="#2196F3" />

                <!-- Charts and Analytics Section with Interactive Features -->
                <TextBlock Text="Financial Trends and Analytics" FontSize="20" FontWeight="Bold" Margin="0,10,0,15" />

                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Budget Trend Chart with Interactive Features -->
                    <Border Grid.Column="0" Background="#1E1E1E" BorderBrush="#2196F3" BorderThickness="2"
                            CornerRadius="8" Margin="5" Padding="15"
                            ToolTipService.ToolTip="6-month historical budget trend showing spending patterns. Use mouse wheel to zoom and drag to pan.">
                        <StackPanel>
                            <TextBlock Text="Budget Trends (Historical Data from Municipal Accounts)"
                                     FontSize="14" FontWeight="SemiBold" Foreground="#2196F3" Margin="0,0,0,10"/>
                            <Grid Height="300">
                                <!-- Chart Content -->
                                <chart:SfChart x:Name="BudgetTrendChart" Height="300">
                                    <chart:SfChart.Style>
                                        <Style TargetType="chart:SfChart">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding BudgetTrendData.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </chart:SfChart.Style>

                                    <chart:SfChart.Header>
                                        <TextBlock Text="6-Month Budget Trend" FontSize="14" FontWeight="Bold"
                                                 HorizontalAlignment="Center" Foreground="White"/>
                                    </chart:SfChart.Header>

                                    <chart:SfChart.Legend>
                                        <chart:ChartLegend DockPosition="Bottom"
                                                         Background="Transparent"
                                                         Foreground="White"/>
                                    </chart:SfChart.Legend>

                                    <chart:SfChart.PrimaryAxis>
                                        <chart:CategoryAxis Header="Period" FontSize="12" />
                                    </chart:SfChart.PrimaryAxis>

                                    <chart:SfChart.SecondaryAxis>
                                        <chart:NumericalAxis Header="Amount (USD)" LabelFormat="C0" FontSize="12" />
                                    </chart:SfChart.SecondaryAxis>

                                    <!-- Enable Trackball for Interactive Tooltips -->
                                    <chart:SfChart.Behaviors>
                                        <chart:ChartTrackBallBehavior ShowLine="True" LineStyle="{DynamicResource TrackBallLineStyle}">
                                            <chart:ChartTrackBallBehavior.ChartTrackBallStyle>
                                                <Style TargetType="chart:ChartTrackBallControl">
                                                    <Setter Property="Background" Value="#2196F3"/>
                                                </Style>
                                            </chart:ChartTrackBallBehavior.ChartTrackBallStyle>
                                        </chart:ChartTrackBallBehavior>
                                        <chart:ChartZoomPanBehavior EnablePanning="True" EnableMouseWheelZooming="True"
                                                                   ZoomMode="XY" EnableZoomingToolBar="True"/>
                                    </chart:SfChart.Behaviors>

                                    <chart:LineSeries ItemsSource="{Binding BudgetTrendData}"
                                                    XBindingPath="Period"
                                                    YBindingPath="Amount"
                                                    Interior="#2196F3"
                                                    StrokeThickness="3"
                                                    Label="Budget"
                                                    ShowTooltip="True"
                                                    EnableAnimation="True">
                                        <chart:LineSeries.AdornmentsInfo>
                                            <chart:ChartAdornmentInfo
                                                                    LabelPosition="Auto"
                                                                    SegmentLabelFormat="C0"
                                                                    Foreground="White"/>
                                        </chart:LineSeries.AdornmentsInfo>
                                        <chart:LineSeries.TooltipTemplate>
                                            <DataTemplate>
                                                <StackPanel>
                                                    <TextBlock Text="{Binding Item.Period}" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Item.Amount, StringFormat='Amount: {0:C0}'}"/>
                                                    <TextBlock Text="Hover for details (data from municipal accounts)"
                                                             FontStyle="Italic" FontSize="10" Foreground="#B0B0B0"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </chart:LineSeries.TooltipTemplate>
                                    </chart:LineSeries>

                                    <chart:LineSeries ItemsSource="{Binding RateTrendData}"
                                                    XBindingPath="Period"
                                                    YBindingPath="Rate"
                                                    Interior="#FF9800"
                                                    StrokeThickness="2"

                                                    Label="Suggested Rate"
                                                    ShowTooltip="True"
                                                    EnableAnimation="True">
                                        <chart:LineSeries.AdornmentsInfo>
                                            <chart:ChartAdornmentInfo
                                                                    LabelPosition="Auto"
                                                                    SegmentLabelFormat="C2"
                                                                    Foreground="White"/>
                                        </chart:LineSeries.AdornmentsInfo>
                                        <chart:LineSeries.TooltipTemplate>
                                            <DataTemplate>
                                                <StackPanel>
                                                    <TextBlock Text="{Binding Item.Period}" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Item.Rate, StringFormat='Suggested Rate: {0:C2}'}"/>
                                                    <TextBlock Text="Calculated based on enterprise expenses and customer count"
                                                             FontStyle="Italic" FontSize="10" Foreground="#B0B0B0"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </chart:LineSeries.TooltipTemplate>
                                    </chart:LineSeries>
                                </chart:SfChart>

                                <!-- Empty State -->
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                          Visibility="Collapsed" x:Name="BudgetEmptyState">
                                    <StackPanel.Style>
                                        <Style TargetType="StackPanel">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding BudgetTrendData.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>

                                    <TextBlock Text="No budget trend data available"
                                                          FontSize="16" FontWeight="SemiBold"
                                                          Foreground="#B0B0B0" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Budget data will appear here once enterprises are configured and have historical data."
                                                          FontSize="12" Foreground="#808080"
                                                          HorizontalAlignment="Center" Margin="0,10,0,0"
                                                          TextWrapping="Wrap" MaxWidth="300"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Enterprise Distribution Pie Chart -->
                    <Border Grid.Column="1" Background="#1E1E1E" BorderBrush="#9C27B0" BorderThickness="2"
                            CornerRadius="8" Margin="5" Padding="15"
                            ToolTipService.ToolTip="Distribution of enterprise types across municipal departments">
                        <StackPanel>
                            <TextBlock Text="Enterprise Distribution" FontSize="14" FontWeight="SemiBold"
                                     Foreground="#9C27B0" Margin="0,0,0,10"/>
                            <Grid Height="300">
                                <chart:SfChart Height="300">
                                    <chart:SfChart.Style>
                                        <Style TargetType="chart:SfChart">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding EnterpriseTypeData.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </chart:SfChart.Style>

                                    <chart:SfChart.Legend>
                                        <chart:ChartLegend DockPosition="Bottom" />
                                    </chart:SfChart.Legend>

                                    <chart:PieSeries ItemsSource="{Binding EnterpriseTypeData}"
                                                   XBindingPath="Type"
                                                   YBindingPath="Count"
                                                   LabelPosition="Inside"
                                                   EnableAnimation="True"
                                                   ExplodeAll="False"
                                                   ExplodeIndex="0"
                                                   ExplodeRadius="10"
                                                   ShowTooltip="True">
                                        <chart:PieSeries.AdornmentsInfo>
                                            <chart:ChartAdornmentInfo
                                                                    LabelPosition="Auto"
                                                                    SegmentLabelFormat="#PERCENT{P0}"
                                                                    Foreground="White"/>
                                        </chart:PieSeries.AdornmentsInfo>
                                    </chart:PieSeries>
                                </chart:SfChart>

                                <!-- Empty State -->
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                          Visibility="Collapsed">
                                    <StackPanel.Style>
                                        <Style TargetType="StackPanel">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding EnterpriseTypeData.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>

                                    <TextBlock Text="No enterprise data available"
                                                          FontSize="16" FontWeight="SemiBold"
                                                          Foreground="#B0B0B0" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Enterprise distribution will appear here once enterprises are configured."
                                                          FontSize="12" Foreground="#808080"
                                                          HorizontalAlignment="Center" Margin="0,10,0,0"
                                                          TextWrapping="Wrap" MaxWidth="300"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Grid>


                <!-- Main Dashboard Chart Section -->
                <TextBlock Text="Financial Overview Dashboard" FontSize="20" FontWeight="Bold" Margin="0,10,0,15" />

                <Border Background="#1E1E1E" BorderBrush="#2196F3" BorderThickness="2"
                        CornerRadius="8" Margin="5,0,5,20" Padding="15"
                        ToolTipService.ToolTip="Comprehensive financial dashboard showing budgets, expenses, and revenues">
                    <StackPanel>
                        <chart:SfChart x:Name="DashboardChart"
                                     Height="400">
                            <chart:SfChart.PrimaryAxis>
                                <chart:CategoryAxis />
                            </chart:SfChart.PrimaryAxis>
                            <chart:SfChart.SecondaryAxis>
                                <chart:NumericalAxis />
                            </chart:SfChart.SecondaryAxis>
                            <chart:SfChart.Header>
                                <TextBlock Text="Financial Dashboard" FontSize="16" FontWeight="Bold"
                                         HorizontalAlignment="Center" Foreground="White"/>
                            </chart:SfChart.Header>

                            <chart:SfChart.Legend>
                                <chart:ChartLegend DockPosition="Bottom"
                                                 Background="Transparent"
                                                 Foreground="White"/>
                            </chart:SfChart.Legend>

                            <chart:ColumnSeries ItemsSource="{Binding ChartData}"
                                              XBindingPath="Period"
                                              YBindingPath="Amount"
                                              Interior="#2196F3"
                                              Label="Total Budget"
                                              ShowTooltip="True"
                                              EnableAnimation="True">
                            </chart:ColumnSeries>

                            <chart:ColumnSeries ItemsSource="{Binding ExpenseData}"
                                              XBindingPath="Period"
                                              YBindingPath="Amount"
                                              Interior="#F44336"
                                              Label="Expenses"
                                              ShowTooltip="True"
                                              EnableAnimation="True">
                            </chart:ColumnSeries>

                            <chart:ColumnSeries ItemsSource="{Binding RevenueData}"
                                              XBindingPath="Period"
                                              YBindingPath="Amount"
                                              Interior="#4CAF50"
                                              Label="Revenue"
                                              ShowTooltip="True"
                                              EnableAnimation="True">
                            </chart:ColumnSeries>
                        </chart:SfChart>
                    </StackPanel>
                </Border>


                <!-- System Alerts Section with Enhanced Formatting -->
                <TextBlock Text="System Alerts and Recent Activity" FontSize="20" FontWeight="Bold" Margin="0,10,0,15" />

                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- System Alerts with Cell Formatting -->
                    <Border Grid.Column="0" Background="#1E1E1E" BorderBrush="#F44336" BorderThickness="2"
                            CornerRadius="8" Margin="5" Padding="15"
                            ToolTipService.ToolTip="Critical alerts for over-budget conditions and system warnings. Click to view details.">
                        <StackPanel>
                            <TextBlock Text="Critical Alerts (Over-Budget Warnings)" FontSize="14"
                                     FontWeight="SemiBold" Foreground="#F44336" Margin="0,0,0,10"/>
                            <syncfusion:SfDataGrid x:Name="SystemAlertsGrid"
                                                 ItemsSource="{Binding SystemAlerts}"
                                                 AllowSorting="True"
                                                 AllowFiltering="True"
                                                 AutoGenerateColumns="False"
                                                 SelectionMode="Single"
                                                 Height="250"
                                                 ToolTipService.ToolTip="Sort by clicking column headers. Filter using the filter icon.">
                                <syncfusion:SfDataGrid.Columns>
                                    <syncfusion:GridTextColumn MappingName="Priority"
                                                              HeaderText="Priority"
                                                              Width="100"/>
                                    <syncfusion:GridTextColumn MappingName="Message"
                                                              HeaderText="Alert Message"
                                                              Width="250" />
                                    <syncfusion:GridTextColumn MappingName="Timestamp"
                                                              HeaderText="Time"
                                                              DisplayBinding="{Binding Timestamp, StringFormat='HH:mm:ss'}"
                                                              Width="100" />
                                </syncfusion:SfDataGrid.Columns>
                            </syncfusion:SfDataGrid>
                        </StackPanel>
                    </Border>

                    <!-- Recent Activity -->
                    <Border Grid.Column="1" Background="#1E1E1E" BorderBrush="#4CAF50" BorderThickness="2"
                            CornerRadius="8" Margin="5" Padding="15"
                            ToolTipService.ToolTip="Recent system activity and transaction log">
                        <StackPanel>
                            <TextBlock Text="Recent Activity" FontSize="14" FontWeight="SemiBold"
                                     Foreground="#4CAF50" Margin="0,0,0,10"/>
                            <syncfusion:SfDataGrid x:Name="RecentActivityGrid"
                                                 ItemsSource="{Binding RecentActivities}"
                                                 AllowSorting="True"
                                                 AllowFiltering="False"
                                                 AutoGenerateColumns="False"
                                                 SelectionMode="Single"
                                                 Height="250"
                                                 ToolTipService.ToolTip="Recent activity feed showing latest transactions and changes">
                                <syncfusion:SfDataGrid.Columns>
                                    <syncfusion:GridTextColumn MappingName="Timestamp"
                                                              HeaderText="Time"
                                                              DisplayBinding="{Binding Timestamp, StringFormat='HH:mm'}"
                                                              Width="80" />
                                    <syncfusion:GridTextColumn MappingName="Description"
                                                              HeaderText="Activity"
                                                              Width="220" />
                                    <syncfusion:GridTextColumn MappingName="Type"
                                                              HeaderText="Type"
                                                              Width="100" />
                                </syncfusion:SfDataGrid.Columns>
                            </syncfusion:SfDataGrid>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Enterprise Data Grid Section with Syncfusion WPF DataGrid -->
                <TextBlock Text="Enterprise Funds Overview" FontSize="20" FontWeight="Bold" Margin="0,10,0,15" />

                <Border Background="#1E1E1E" BorderBrush="#2196F3" BorderThickness="2"
                        CornerRadius="8" Margin="5,0,5,20" Padding="15"
                        ToolTipService.ToolTip="Complete list of enterprise funds with sorting and filtering capabilities">
                    <StackPanel>
                        <!-- Search Bar -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,10,0" FontSize="14"/>
                            <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                   Height="30" VerticalContentAlignment="Center"
                                   ToolTipService.ToolTip="Search enterprises by name or description"/>
                            <syncfusion:ButtonAdv Grid.Column="2" Content="Clear" Command="{Binding ClearSearchCommand}"
                                                Margin="10,0,0,0" Height="30" Width="80"
                                                ToolTipService.ToolTip="Clear search filter"/>
                        </Grid>

                        <!-- Enterprises DataGrid with explicit columns as per Syncfusion WPF documentation -->
                        <syncfusion:SfDataGrid x:Name="EnterprisesGrid"
                                             ItemsSource="{Binding Enterprises, UpdateSourceTrigger=PropertyChanged, FallbackValue={}}"
                                             AutoGenerateColumns="False"
                                             AllowSorting="True"
                                             AllowFiltering="True"
                                             AllowResizingColumns="True"
                                             AllowGrouping="True"
                                             SelectionMode="Single"
                                             Height="350"
                                             ColumnSizer="Star"
                                             ToolTipService.ToolTip="Click column headers to sort. Use filter icon for filtering.">

                            <!-- Define explicit columns as per Syncfusion WPF DataGrid documentation -->
                            <syncfusion:SfDataGrid.Columns>
                                <syncfusion:GridTextColumn MappingName="Name"
                                                          HeaderText="Enterprise Name"
                                                          Width="200"
                                                          AllowFiltering="True"
                                                          AllowSorting="True"/>

                                <syncfusion:GridTextColumn MappingName="Description"
                                                          HeaderText="Description"
                                                          Width="250"
                                                          AllowFiltering="True"/>

                                <syncfusion:GridNumericColumn MappingName="TotalBudget"
                                                             HeaderText="Total Budget"
                                                             Width="150"
                                                             DisplayBinding="{Binding TotalBudget, StringFormat=C0}"
                                                             AllowSorting="True"
                                                             TextAlignment="Right"/>

                                <syncfusion:GridTextColumn MappingName="Status"
                                                          HeaderText="Status"
                                                          Width="120"
                                                          AllowFiltering="True"
                                                          AllowSorting="True"/>

                                <syncfusion:GridDateTimeColumn MappingName="LastModified"
                                                              HeaderText="Last Modified"
                                                              Width="150"
                                                              DisplayBinding="{Binding LastModified, StringFormat='MM/dd/yyyy'}"
                                                              AllowSorting="True"/>

                                <syncfusion:GridNumericColumn MappingName="Id"
                                                             HeaderText="ID"
                                                             Width="80"
                                                             AllowSorting="True"
                                                             TextAlignment="Right"/>
                            </syncfusion:SfDataGrid.Columns>
                        </syncfusion:SfDataGrid>

                        <!-- Empty State Display -->
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,20,0,0"
                                  Visibility="{Binding Enterprises.Count, Converter={StaticResource CountToVisibilityConverter}}">
                            <TextBlock Text="No Enterprise Data Available"
                                     FontSize="18" FontWeight="SemiBold"
                                     Foreground="#B0B0B0" HorizontalAlignment="Center"/>
                            <TextBlock Text="Enterprise funds will appear here once configured in the system."
                                     FontSize="12" Foreground="#808080"
                                     HorizontalAlignment="Center" Margin="0,10,0,0"
                                     TextWrapping="Wrap" MaxWidth="400"/>
                        </StackPanel>

                        <!-- Error Message Display -->
                        <TextBlock Text="{Binding ErrorMessage}"
                                 Foreground="#F44336"
                                 FontSize="12"
                                 Margin="0,10,0,0"
                                 TextWrapping="Wrap"
                                 Visibility="{Binding ErrorMessage, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>

                <!-- Quick Actions / Navigation Tiles -->
                <TextBlock Text="Quick Navigation" FontSize="20" FontWeight="Bold" Margin="0,10,0,15" />

                <WrapPanel Orientation="Horizontal" Margin="0,0,0,20">
                    <syncfusion:ButtonAdv Content="Enterprise Management"
                                         Command="{Binding OpenEnterpriseManagementCommand}"
                                         Margin="5"
                                         Width="180" Height="60"
                                         SizeMode="Large"
                                         IconHeight="24" IconWidth="24"
                                         IsEnabled="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter=invert}">
                        <syncfusion:ButtonAdv.ToolTip>
                            <TextBlock Text="Manage municipal enterprise accounts"/>
                        </syncfusion:ButtonAdv.ToolTip>
                    </syncfusion:ButtonAdv>

                    <syncfusion:ButtonAdv Content="Budget Analysis"
                                         Command="{Binding OpenBudgetAnalysisCommand}"
                                         Margin="5"
                                         Width="180" Height="60"
                                         SizeMode="Large"
                                         IsEnabled="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter=invert}">
                        <syncfusion:ButtonAdv.ToolTip>
                            <TextBlock Text="View detailed budget analysis and GASB reports"/>
                        </syncfusion:ButtonAdv.ToolTip>
                    </syncfusion:ButtonAdv>

                    <syncfusion:ButtonAdv Content="Generate Report"
                                         Command="{Binding GenerateReportCommand}"
                                         Margin="5"
                                         Width="180" Height="60"
                                         SizeMode="Large"
                                         IsEnabled="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter=invert}">
                        <syncfusion:ButtonAdv.ToolTip>
                            <TextBlock Text="Generate financial reports for municipal accounts"/>
                        </syncfusion:ButtonAdv.ToolTip>
                    </syncfusion:ButtonAdv>

                    <syncfusion:ButtonAdv Content="Settings"
                                         Command="{Binding OpenSettingsCommand}"
                                         Margin="5"
                                         Width="180" Height="60"
                                         SizeMode="Large"
                                         IsEnabled="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter=invert}">
                        <syncfusion:ButtonAdv.ToolTip>
                            <TextBlock Text="Configure application settings"/>
                        </syncfusion:ButtonAdv.ToolTip>
                    </syncfusion:ButtonAdv>

                    <syncfusion:ButtonAdv Content="Backup Data"
                                         Command="{Binding BackupDataCommand}"
                                         Margin="5"
                                         Width="180" Height="60"
                                         SizeMode="Large"
                                         IsEnabled="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter=invert}">
                        <syncfusion:ButtonAdv.ToolTip>
                            <TextBlock Text="Backup municipal financial data"/>
                        </syncfusion:ButtonAdv.ToolTip>
                    </syncfusion:ButtonAdv>
                </WrapPanel>
            </StackPanel>
        </ScrollViewer>

        <!-- Status Bar -->
        <StatusBar DockPanel.Dock="Bottom" Background="Transparent">
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Last Updated: "/><Run Text="{Binding LastUpdated}" />
                </TextBlock>
            </StatusBarItem>
            <StatusBarItem>
                <notification:SfBusyIndicator IsBusy="{Binding IsLoading}"
                                            Header="{Binding StatusMessage, FallbackValue='Loading...'}"
                                            AnimationType="Windmill"
                                            Width="100" Height="20"
                                            Foreground="White" />
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Status: "/><Run Text="{Binding DashboardStatus}" />
                </TextBlock>
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Next Refresh: "/><Run Text="{Binding NextRefreshTime}" />
                </TextBlock>
            </StatusBarItem>
        </StatusBar>
    </DockPanel>
    </Grid>
</UserControl>
